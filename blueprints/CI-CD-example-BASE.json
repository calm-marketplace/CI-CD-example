{"status":{},"spec":{"description":"Versions:\n\n1. docker\n2. docker-compose\n3. artifactory\n4. gitolite\n5. \n\nPreparing an updated version:\n\n1. Use a VM based on the same Centos Cloud-Image version you plan to use\n2. ","resources":{"client_attrs":{"073fb9fd_deployment_cloned_1_cloned_2":{"y":-572.5507080187,"x":-416.114788341},"073fb9fd_deployment":{"y":-627.186746988,"x":45.4638554217},"073fb9fd_deployment_cloned_1_cloned_1":{"y":-226.5507080187,"x":-477.114788341},"073fb9fd_deployment_cloned_1":{"y":-362.5507080187,"x":-692.114788341},"073fb9fd_deployment_cloned_1_cloned_2_cloned_1":{"y":-680.5507080187,"x":-228.114788341},"073fb9fd_deployment_cloned_1_cloned_1_cloned_1":{"y":-589.012390279,"x":-657.2313395073},"120e2714-a288-672a-669c-919f6919ce48":{"y":51.8132553101,"x":-9.4736480713}},"service_definition_list":[{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Developer Workstation"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"cedd2a9f_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"d9aa452b_runbook","main_task_local_reference":{"kind":"app_task","name":"cedd2a9f_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Developer Workstation"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"2e59a97c_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"2a1f7d12_runbook","main_task_local_reference":{"kind":"app_task","name":"2e59a97c_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Developer Workstation"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"5242af7c_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"467abe3f_runbook","main_task_local_reference":{"kind":"app_task","name":"5242af7c_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Developer Workstation"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"ac646600_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"249fd947_runbook","main_task_local_reference":{"kind":"app_task","name":"ac646600_dag"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Developer Workstation"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"34e772eb_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"d85613e3_runbook","main_task_local_reference":{"kind":"app_task","name":"34e772eb_dag"},"variable_list":[]},"name":"action_restart"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Load Cert"},{"kind":"app_task","name":"Configure User"}],"name":"522d1b4f_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Load Cert"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Configure User"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Developer Workstation"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Load Cert","attrs":{"exit_status":[],"script":"echo \"Create host entries\"\necho \"@@{DockerRegistry.address}@@ @@{DockerRegistry.name}@@.@@{domain_name}@@ @@{DockerRegistry.name}@@\" | sudo tee -a \/etc\/hosts\necho \"@@{GitoLite.address}@@ @@{GitoLite.name}@@.@@{domain_name}@@ @@{GitoLite.name}@@\" | sudo tee -a \/etc\/hosts\necho \"@@{Artifactory.address}@@ artifactory.@@{domain_name}@@ artifactory\" | sudo tee -a \/etc\/hosts\n\necho \"Load Cert\"\nsudo mkdir \/usr\/local\/share\/ca-certificates\/docker-dev-cert\nREGISTRY_IP=@@{DockerRegistry.address}@@\nsshpass -p @@{centos.secret}@@ scp -oStrictHostKeyChecking=no ${REGISTRY_IP}:~\/devdockerCA.crt \/tmp\nsudo mv \/tmp\/devdockerCA.crt \/usr\/local\/share\/ca-certificates\/docker-dev-cert\/devdockerCA.crt\nsudo update-ca-certificates\nsudo service docker restart","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"centos"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Developer Workstation"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Configure User","attrs":{"exit_status":[],"script":"mkdir ~\/.ssh\nchmod 700 ~\/.ssh\necho 'set -o vi' >> ~\/.bashrc\necho 'export DOCKER_REGISTRY=@@{DockerRegistry.name}@@.@@{domain_name}@@' >> ~\/.bashrc\necho 'StrictHostKeyChecking no' > ~\/.ssh\/config\n\necho \"Create SSH Keys\"\ncp @@{birth_project}@@\/keys\/id_calm_rsa ~\/.ssh\/id_rsa\ncp @@{birth_project}@@\/keys\/id_calm_rsa.pub ~\/.ssh\/id_rsa.pub\nchmod 600 ~\/.ssh\/id_rsa\nchmod 600 ~\/.ssh\/id_rsa.pub\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"centos"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"3ea58e8a_runbook","main_task_local_reference":{"kind":"app_task","name":"522d1b4f_dag"},"variable_list":[]},"name":"Configure Connectivity"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Initialize DevOps Repo"},{"kind":"app_task","name":"Download Demo Code"},{"kind":"app_task","name":"Create and Push Docker Images"}],"name":"ea902467_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Initialize DevOps Repo"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Download Demo Code"}},{"from_task_reference":{"kind":"app_task","name":"Download Demo Code"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Create and Push Docker Images"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Developer Workstation"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Initialize DevOps Repo","attrs":{"exit_status":[],"script":"echo \"Initialize DevOps Git Project\"\ngit clone git@@@{GitoLite.name}@@.@@{domain_name}@@:devops.git\n\ngit config user.name nutanix\ngit config user.email nutanix@@@{name}@@.@@{domain_name}@@\ngit config --global push.default matching","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"centos"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Developer Workstation"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Download Demo Code","attrs":{"exit_status":[],"script":"echo \"Get Demo Code\"\ncd devops\ncp @@{birth_project}@@\/downloads\/cicd-demo.tar.gz .\ntar xvfz cicd-demo.tar.gz\nrm cicd-demo.tar.gz","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"centos"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Developer Workstation"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Create and Push Docker Images","attrs":{"exit_status":[],"script":"export DOCKER_REGISTRY=@@{DockerRegistry.name}@@.@@{domain_name}@@\necho \"Login into Docker Registry\"\ndocker login -u @@{centos.username}@@ -p @@{centos.secret}@@ $DOCKER_REGISTRY\ncd ~\/devops\n\necho \"Build and Push Ansible Image\"\ndocker build -t ${DOCKER_REGISTRY}\/centos\/ansible docker-ansible\/src\ndocker push ${DOCKER_REGISTRY}\/centos\/ansible","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"centos"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"e1100d06_runbook","main_task_local_reference":{"kind":"app_task","name":"ea902467_dag"},"variable_list":[]},"name":"Setup Demo Project"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Jenkins Master Details"},{"kind":"app_task","name":"Developer Workstation Details"},{"kind":"app_task","name":"Docker Repository Details"},{"kind":"app_task","name":"Artifactory Details"}],"name":"290d15c6_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Jenkins Master Details"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Developer Workstation Details"}},{"from_task_reference":{"kind":"app_task","name":"Developer Workstation Details"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Docker Repository Details"}},{"from_task_reference":{"kind":"app_task","name":"Docker Repository Details"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Artifactory Details"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Developer Workstation"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Jenkins Master Details","attrs":{"exit_status":[],"script":"print \"-------------------------\"\nprint \"\"\nprint \"Jenkins Master Host Name:\"\nprint \"@@{Jenkins Master.name}@@\"\nprint \"\"\nprint \"Jenkins Master IP Address:\"\nprint \"@@{Jenkins Master.address}@@\"\nprint \"\"\nprint \"Initial Authorization Password:\"\nprint \"@@{Jenkins Master.jenkins_authorization}@@\"\nprint \"\"\nprint \"Jenkins Master URL:\"\nprint \"http:\/\/@@{Jenkins Master.address}@@:8080\/\"\nprint \"\"\nprint \"-------------------------\"","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"centos"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Developer Workstation"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Developer Workstation Details","attrs":{"exit_status":[],"script":"print \"-------------------------\"\nprint \"\"\nprint \"Developer Workstaion Host Name:\"\nprint \"@@{name}@@\"\nprint \"\"\nprint \"Developer Workstaion IP Address:\"\nprint \"@@{address}@@\"\nprint \"\"\nprint \"-------------------------\"","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"centos"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Developer Workstation"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Docker Repository Details","attrs":{"exit_status":[],"script":"print \"-------------------------\"\nprint \"\"\nprint \"Docker Registry Host Name:\"\nprint \"@@{DockerRegistry.name}@@\"\nprint \"\"\nprint \"Docker Registry IP Address:\"\nprint \"@@{DockerRegistry.address}@@\"\nprint \"\"\nprint \"Docker Registry URLs:\"\nprint \"View Repostitories:\"\nprint \"https:\/\/@@{DockerRegistry.address}@@\/v2\/_catalog\"\nprint \"\"\nprint \"View Tags:\"\nprint \"https:\/\/@@{DockerRegistry.address}@@\/v2\/<repository>\/tags\/list\"\nprint \"\"\nprint \"For Example\"\nprint \"https:\/\/@@{DockerRegistry.address}@@\/v2\/nutanix\/ansible\/tags\/list\"\nprint \"\"\nprint \"-------------------------\"","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"centos"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Developer Workstation"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Artifactory Details","attrs":{"exit_status":[],"script":"print \"-------------------------\"\nprint \"\"\nprint \"Artifactory Host Name:\"\nprint \"@@{Artifactory.name}@@\"\nprint \"\"\nprint \"Artifactory IP Address:\"\nprint \"@@{Artifactory.address}@@\"\nprint \"\"\nprint \"Artifactory URL:\"\nprint \"http:\/\/@@{Artifactory.address}@@:8081\/artifactory\/webapp\"\nprint \"\"\nprint \"-------------------------\"","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"centos"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"19eae6d5_runbook","main_task_local_reference":{"kind":"app_task","name":"290d15c6_dag"},"variable_list":[]},"name":"Output Connection Details"}],"depends_on_list":[],"name":"Developer Workstation","port_list":[],"tier":"","variable_list":[],"description":""},{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"GitoLite"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"cedd2a9f_dag_cloned_1","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"d9aa452b_runbook_cloned_1","main_task_local_reference":{"kind":"app_task","name":"cedd2a9f_dag_cloned_1"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"GitoLite"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"2e59a97c_dag_cloned_1","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"2a1f7d12_runbook_cloned_1","main_task_local_reference":{"kind":"app_task","name":"2e59a97c_dag_cloned_1"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"GitoLite"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"5242af7c_dag_cloned_1","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"467abe3f_runbook_cloned_1","main_task_local_reference":{"kind":"app_task","name":"5242af7c_dag_cloned_1"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"GitoLite"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"ac646600_dag_cloned_1","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"249fd947_runbook_cloned_1","main_task_local_reference":{"kind":"app_task","name":"ac646600_dag_cloned_1"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"GitoLite"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"34e772eb_dag_cloned_1","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"d85613e3_runbook_cloned_1","main_task_local_reference":{"kind":"app_task","name":"34e772eb_dag_cloned_1"},"variable_list":[]},"name":"action_restart"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Configure Project Access"},{"kind":"app_task","name":"Init Demo Repository"}],"name":"d284b6d8_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Configure Project Access"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Init Demo Repository"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"GitoLite"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Configure Project Access","attrs":{"exit_status":[],"script":"echo \"Create Key File\"\ncp @@{birth_project}@@\/keys\/id_calm_rsa.pub ~\/gitolite-admin\/keydir\/jenkins.pub \n\necho \"Configure Repository Access\"\necho \"repo devops\" >> ~\/gitolite-admin\/conf\/gitolite.conf\necho \"    RW+     =   @all\" >> ~\/gitolite-admin\/conf\/gitolite.conf \necho \"    R       =   jenkins\" >> ~\/gitolite-admin\/conf\/gitolite.conf \n\necho \"Check IN and Commit Changes\"\ncd gitolite-admin\ngit add keydir\/jenkins.pub\ngit add conf\/gitolite.conf\ngit config --global user.name nutanix\ngit config --global user.email nutanix@@@{domain_name}@@\ngit config --global push.default matching\ngit commit -m \"Added Jenkins\"\ngit push origin master\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"centos"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"GitoLite"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Init Demo Repository","attrs":{"exit_status":[],"script":"echo \"Create and Configure Repository\"\nsudo su -c 'mkdir ~\/repositories\/devops.git' - git\nsudo su -c 'cd ~\/repositories\/devops.git && git init --bare' - git","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"centos"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"374b5273_runbook","main_task_local_reference":{"kind":"app_task","name":"d284b6d8_dag"},"variable_list":[]},"name":"Configure Demo Project"}],"depends_on_list":[],"name":"GitoLite","port_list":[],"tier":"","variable_list":[],"description":""},{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Artifactory"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"cedd2a9f_dag_cloned_1_cloned_1","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"d9aa452b_runbook_cloned_1_cloned_1","main_task_local_reference":{"kind":"app_task","name":"cedd2a9f_dag_cloned_1_cloned_1"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Artifactory"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"2e59a97c_dag_cloned_1_cloned_1","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"2a1f7d12_runbook_cloned_1_cloned_1","main_task_local_reference":{"kind":"app_task","name":"2e59a97c_dag_cloned_1_cloned_1"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Artifactory"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"5242af7c_dag_cloned_1_cloned_1","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"467abe3f_runbook_cloned_1_cloned_1","main_task_local_reference":{"kind":"app_task","name":"5242af7c_dag_cloned_1_cloned_1"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Artifactory"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"ac646600_dag_cloned_1_cloned_1","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"249fd947_runbook_cloned_1_cloned_1","main_task_local_reference":{"kind":"app_task","name":"ac646600_dag_cloned_1_cloned_1"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Artifactory"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"34e772eb_dag_cloned_1_cloned_1","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"d85613e3_runbook_cloned_1_cloned_1","main_task_local_reference":{"kind":"app_task","name":"34e772eb_dag_cloned_1_cloned_1"},"variable_list":[]},"name":"action_restart"}],"depends_on_list":[],"name":"Artifactory","port_list":[],"tier":"","variable_list":[],"description":""},{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"DockerRegistry"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"cedd2a9f_dag_cloned_1_cloned_1_cloned_1","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"d9aa452b_runbook_cloned_1_cloned_1_cloned_1","main_task_local_reference":{"kind":"app_task","name":"cedd2a9f_dag_cloned_1_cloned_1_cloned_1"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"DockerRegistry"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"2e59a97c_dag_cloned_1_cloned_1_cloned_1","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"2a1f7d12_runbook_cloned_1_cloned_1_cloned_1","main_task_local_reference":{"kind":"app_task","name":"2e59a97c_dag_cloned_1_cloned_1_cloned_1"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"DockerRegistry"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"5242af7c_dag_cloned_1_cloned_1_cloned_1","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"467abe3f_runbook_cloned_1_cloned_1_cloned_1","main_task_local_reference":{"kind":"app_task","name":"5242af7c_dag_cloned_1_cloned_1_cloned_1"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"DockerRegistry"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"ac646600_dag_cloned_1_cloned_1_cloned_1","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"249fd947_runbook_cloned_1_cloned_1_cloned_1","main_task_local_reference":{"kind":"app_task","name":"ac646600_dag_cloned_1_cloned_1_cloned_1"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"DockerRegistry"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"34e772eb_dag_cloned_1_cloned_1_cloned_1","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"d85613e3_runbook_cloned_1_cloned_1_cloned_1","main_task_local_reference":{"kind":"app_task","name":"34e772eb_dag_cloned_1_cloned_1_cloned_1"},"variable_list":[]},"name":"action_restart"}],"depends_on_list":[],"name":"DockerRegistry","port_list":[],"tier":"","variable_list":[],"description":""},{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"cedd2a9f_dag_cloned_1_cloned_1","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"d9aa452b_runbook_cloned_1_cloned_2","main_task_local_reference":{"kind":"app_task","name":"cedd2a9f_dag_cloned_1_cloned_1"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"2e59a97c_dag_cloned_1_cloned_1","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"2a1f7d12_runbook_cloned_1_cloned_2","main_task_local_reference":{"kind":"app_task","name":"2e59a97c_dag_cloned_1_cloned_1"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"5242af7c_dag_cloned_1_cloned_1","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"467abe3f_runbook_cloned_1_cloned_2","main_task_local_reference":{"kind":"app_task","name":"5242af7c_dag_cloned_1_cloned_1"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"ac646600_dag_cloned_1_cloned_1","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"249fd947_runbook_cloned_1_cloned_2","main_task_local_reference":{"kind":"app_task","name":"ac646600_dag_cloned_1_cloned_1"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"34e772eb_dag_cloned_1_cloned_1","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"d85613e3_runbook_cloned_1_cloned_2","main_task_local_reference":{"kind":"app_task","name":"34e772eb_dag_cloned_1_cloned_1"},"variable_list":[]},"name":"action_restart"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Setup SSH"}],"name":"0042d60a_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Setup SSH","attrs":{"exit_status":[],"script":"mkdir ~\/.ssh\nchmod 700 ~\/.ssh\necho 'set -o vi' >> ~\/.bashrc\necho 'StrictHostKeyChecking no' > ~\/.ssh\/config\nchmod 600 ~\/.ssh\/config\n\necho \"Copy SSH Keys\"\ncp @@{birth_project}@@\/keys\/id_calm_rsa ~\/.ssh\/id_rsa\ncp @@{birth_project}@@\/keys\/id_calm_rsa.pub ~\/.ssh\/id_rsa.pub\nchmod 600 ~\/.ssh\/id_*\ncp ~\/.ssh\/id_rsa.pub ~\/.ssh\/authorized_keys","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"centos"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"5ea2d4b5_runbook","main_task_local_reference":{"kind":"app_task","name":"0042d60a_dag"},"variable_list":[]},"name":"Configure Base User"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Install Plugins"},{"kind":"app_task","name":"Get Initial Authorization Password"},{"kind":"app_task","name":"Restart Jenkins"},{"kind":"app_task","name":"Jenkins Master Create Jenkins Credential"}],"name":"5ee29d98_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Install Plugins"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Get Initial Authorization Password"}},{"from_task_reference":{"kind":"app_task","name":"Get Initial Authorization Password"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Restart Jenkins"}},{"from_task_reference":{"kind":"app_task","name":"Restart Jenkins"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Jenkins Master Create Jenkins Credential"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Install Plugins","attrs":{"exit_status":[],"script":"#Install Basic plugins\nsudo systemctl stop jenkins \nsudo mkdir -p \/var\/lib\/jenkins\/plugins\nsudo cp -R @@{birth_project}@@\/downloads\/jenkins-plugins\/* \/var\/lib\/jenkins\/plugins\nsudo chown jenkins:jenkins \/var\/lib\/jenkins\/plugins\/*\nsudo systemctl start jenkins \nsleep 60\n\necho \"Initial admin password is\"\nsudo cat \/var\/lib\/jenkins\/secrets\/initialAdminPassword","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"centos"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Get Initial Authorization Password","attrs":{"exit_status":[],"script":"echo \"-------------------------\"\necho \"\"\necho \"Initial Authorization Password:\"\necho $(sudo cat \/var\/lib\/jenkins\/secrets\/initialAdminPassword)\necho \"\"\necho \"-------------------------\"\necho \"jenkins_authorization=\"$(sudo cat \/var\/lib\/jenkins\/secrets\/initialAdminPassword)","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"centos"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Restart Jenkins","attrs":{"exit_status":[],"script":"sudo systemctl restart jenkins","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"centos"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Jenkins Master Create Jenkins Credential","attrs":{"exit_status":[],"script":"sleep 60\n\necho \"Install Jenkins CLI\"\ncurl -sL http:\/\/@@{address}@@:8080\/jnlpJars\/jenkins-cli.jar -o jenkins-cli.jar\n\necho \"Create Jenkins Credential\"\nJENKINS_SSH_KEY=$(sudo cat \/var\/lib\/jenkins\/.ssh\/id_rsa)\n\necho '<com.cloudbees.jenkins.plugins.sshcredentials.impl.BasicSSHUserPrivateKey plugin=\"ssh-credentials@1.13\">\n  <scope>GLOBAL<\/scope>\n  <id>Jenkins<\/id>\n  <description><\/description>\n  <username>jenkins<\/username>\n  <privateKeySource class=\"com.cloudbees.jenkins.plugins.sshcredentials.impl.BasicSSHUserPrivateKey$DirectEntryPrivateKeySource\">\n    <privateKey>@@{centos.secret}@@<\/privateKey>\n  <\/privateKeySource>\n<\/com.cloudbees.jenkins.plugins.sshcredentials.impl.BasicSSHUserPrivateKey>' | sudo java -jar jenkins-cli.jar -auth admin:@@{jenkins_authorization}@@ -s http:\/\/@@{address}@@:8080 create-credentials-by-xml system::system::jenkins _\n\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"centos"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"c22b4b0e_runbook","main_task_local_reference":{"kind":"app_task","name":"5ee29d98_dag"},"variable_list":[]},"name":"Configure Jenkins Master"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Setup SSH Jenkins User"}],"name":"e945866f_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Setup SSH Jenkins User","attrs":{"exit_status":[],"script":"echo \"Copy SSH Keys\"\nsudo su -c 'mkdir ~\/.ssh' - jenkins\nsudo su -c 'chmod 700 ~\/.ssh' - jenkins\nsudo cp @@{birth_project}@@\/keys\/id_calm_rsa \/home\/jenkins\/.ssh\/id_rsa\nsudo cp @@{birth_project}@@\/keys\/id_calm_rsa.pub \/home\/jenkins\/.ssh\/id_rsa.pub\nsudo chown jenkins:jenkins \/home\/jenkins\/.ssh\/id_*\nsudo su -c 'chmod 600 ~\/.ssh\/id_rsa*' - jenkins\nsudo su -c 'echo \"set -o vi\" > ~\/.bashrc' - jenkins\nsudo su -c 'echo \"StrictHostKeyChecking no\" > ~\/.ssh\/config' - jenkins\n\necho \"\"\necho \"Get Public Key\"\necho \"jenkins_ssh_key_pub=\"$(sudo cat \/var\/lib\/jenkins\/.ssh\/id_rsa.pub)\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"centos"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"61185f7f_runbook","main_task_local_reference":{"kind":"app_task","name":"e945866f_dag"},"variable_list":[]},"name":"Setup SSH Jenkins User"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Create Initial Config"}],"name":"8dcc1fb7_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Create Initial Config","attrs":{"exit_status":[],"script":"echo 'Update Jenkins Configuration'\nsudo su -c \"sed -i 's\/<installStateName>NEW<\/<installStateName>RUNNING<\/' ~\/config.xml\" - jenkins\nsudo su -c \"sed -i 's\/numExecutors>2<\/numExecutors>0<\/' ~\/config.xml\" - jenkins\n\necho 'Create Location Configuration'\nprintf \"<?xml version='1.1' encoding='UTF-8'?>\n<jenkins.model.JenkinsLocationConfiguration>\n  <jenkinsUrl>http:\/\/@@{address}@@:8080\/<\/jenkinsUrl>\n<\/jenkins.model.JenkinsLocationConfiguration>\" | sudo su -c 'tee ~\/jenkins.model.JenkinsLocationConfiguration.xml' - jenkins\n\necho 'Set State and Version Configurations'\nsudo cat \/var\/lib\/jenkins.install.UpgradeWizard.state | sudo su -c 'tee ~\/jenkins.install.InstallUtil.lastExecVersion' - jenkins\n\necho 'Configure SSH'\nprintf \"<?xml version='1.1' encoding='UTF-8'?>\n<org.jenkinsci.main.modules.sshd.SSHD>\n  <port>22<\/port>\n<\/org.jenkinsci.main.modules.sshd.SSHD>\" | sudo su -c 'tee ~\/org.jenkinsci.main.modules.sshd.SSHD.xml' - jenkins\n\necho 'Create Demo Pipeline'\nsudo su -c 'mkdir -p ~\/jobs\/devops\/builds' - jenkins\nsudo su -c 'touch ~\/jobs\/devops\/builds\/legacyIds' - jenkins\nsudo su -c 'echo 1 > ~\/jobs\/devops\/nextBuildNumber' - jenkins\n\necho '<?xml version=\"1.1\" encoding=\"UTF-8\"?>\n<flow-definition plugin=\"workflow-job@2.23\">\n  <actions\/>\n  <description><\/description>\n  <keepDependencies>false<\/keepDependencies>\n  <properties>\n    <hudson.model.ParametersDefinitionProperty>\n      <parameterDefinitions>\n        <hudson.model.StringParameterDefinition>\n          <name>DOCKER_REGISTRY_USER<\/name>\n          <description><\/description>\n          <defaultValue>@@{centos.username}@@<\/defaultValue>\n          <trim>false<\/trim>\n        <\/hudson.model.StringParameterDefinition>\n        <hudson.model.PasswordParameterDefinition>\n          <name>DOCKER_REGISTRY_PASSWORD<\/name>\n          <description><\/description>\n          <defaultValue>@@{centos.secret}@@<\/defaultValue>\n        <\/hudson.model.PasswordParameterDefinition>\n        <hudson.model.StringParameterDefinition>\n          <name>DOCKER_REGISTRY<\/name>\n          <description><\/description>\n          <defaultValue>@@{DockerRegistry.name}@@.@@{domain_name}@@<\/defaultValue>\n          <trim>false<\/trim>\n        <\/hudson.model.StringParameterDefinition>\n        <hudson.model.StringParameterDefinition>\n          <name>REPO_NAME<\/name>\n          <description><\/description>\n          <defaultValue>devops<\/defaultValue>\n          <trim>false<\/trim>\n        <\/hudson.model.StringParameterDefinition>\n      <\/parameterDefinitions>\n    <\/hudson.model.ParametersDefinitionProperty>\n  <\/properties>\n  <definition class=\"org.jenkinsci.plugins.workflow.cps.CpsScmFlowDefinition\" plugin=\"workflow-cps@2.54\">\n    <scm class=\"hudson.plugins.git.GitSCM\" plugin=\"git@3.9.1\">\n      <configVersion>2<\/configVersion>\n      <userRemoteConfigs>\n        <hudson.plugins.git.UserRemoteConfig>\n          <url>git@@@{GitoLite.name}@@.@@{domain_name}@@:devops.git<\/url>\n          <credentialsId>Jenkins<\/credentialsId>\n        <\/hudson.plugins.git.UserRemoteConfig>\n      <\/userRemoteConfigs>\n      <branches>\n        <hudson.plugins.git.BranchSpec>\n          <name>*\/master<\/name>\n        <\/hudson.plugins.git.BranchSpec>\n      <\/branches>\n      <doGenerateSubmoduleConfigurations>false<\/doGenerateSubmoduleConfigurations>\n      <submoduleCfg class=\"list\"\/>\n      <extensions\/>\n    <\/scm>\n    <scriptPath>Jenkinsfile<\/scriptPath>\n    <lightweight>true<\/lightweight>\n  <\/definition>\n  <triggers\/>\n  <authToken>ThisIsTheAPITokenToUse<\/authToken>\n  <disabled>false<\/disabled>\n<\/flow-definition>' | sudo su -c 'tee ~\/jobs\/devops\/config.xml' - jenkins\n\nsudo su -c 'chmod 644 ~\/jobs\/devops\/config.xml' - jenkins\nsudo su -c 'chmod 644 ~\/jobs\/devops\/nextBuildNumber' - jenkins\nsudo su -c 'chmod 644 ~\/jobs\/devops\/builds\/legacyIds' - jenkins\n\necho 'Setup Script Approvals'\necho '<?xml version=\"1.1\" encoding=\"UTF-8\"?>\n<scriptApproval plugin=\"script-security@1.44\">\n  <approvedScriptHashes\/>\n  <approvedSignatures>\n    <string>method groovy.json.JsonSlurperClassic parseText java.lang.String<\/string>\n    <string>method java.util.Map remove java.lang.Object<\/string>\n    <string>new groovy.json.JsonSlurperClassic<\/string>\n    <string>new java.util.HashMap java.util.Map<\/string>\n  <\/approvedSignatures>\n  <aclApprovedSignatures\/>\n  <approvedClasspathEntries\/>\n  <pendingScripts\/>\n  <pendingSignatures\/>\n  <pendingClasspathEntries\/>\n<\/scriptApproval>' | sudo su -c 'tee ~\/scriptApproval.xml' - jenkins\n\necho \"Create App Deploy Job\"\nsudo su -c 'mkdir -p ~\/jobs\/deploy\/builds' - jenkins\nsudo su -c 'touch ~\/jobs\/deploy\/builds\/legacyIds' - jenkins\nsudo su -c 'echo 1 > ~\/jobs\/deploy\/nextBuildNumber' - jenkins\necho '<?xml version=\"1.1\" encoding=\"UTF-8\"?>\n<flow-definition plugin=\"workflow-job@2.23\">\n  <actions\/>\n  <description><\/description>\n  <keepDependencies>false<\/keepDependencies>\n  <properties>\n    <hudson.model.ParametersDefinitionProperty>\n      <parameterDefinitions>\n        <hudson.model.StringParameterDefinition>\n          <name>ARTIFACTORY_IP<\/name>\n          <description><\/description>\n          <defaultValue>@@{Artifactory.address}@@<\/defaultValue>\n          <trim>false<\/trim>\n        <\/hudson.model.StringParameterDefinition>\n        <hudson.model.StringParameterDefinition>\n          <name>REPO_NAME<\/name>\n          <description><\/description>\n          <defaultValue><\/defaultValue>\n          <trim>false<\/trim>\n        <\/hudson.model.StringParameterDefinition>\n        <hudson.model.StringParameterDefinition>\n          <name>BUILD_NUMBER<\/name>\n          <description><\/description>\n          <defaultValue><\/defaultValue>\n          <trim>false<\/trim>\n        <\/hudson.model.StringParameterDefinition>\n      <\/parameterDefinitions>\n    <\/hudson.model.ParametersDefinitionProperty>\n  <\/properties>\n  <definition class=\"org.jenkinsci.plugins.workflow.cps.CpsFlowDefinition\" plugin=\"workflow-cps@2.54\">\n    <script>import groovy.json.JsonSlurperClassic\nimport groovy.json.JsonOutput\n\nnode() {\n    stage(&apos;Deploy Application Via Calm&apos;){\n        echo &quot;Application deployment visual&quot;\n    }\n}\n\ndef response = httpRequest authentication: &apos;PC-User&apos;, consoleLogResponseBody: false, customHeaders: [[maskValue: false, name: &apos;Content-Type&apos;, value: &apos;application\/json&apos;]], ignoreSslErrors: true, responseHandle: &apos;LEAVE_OPEN&apos;, url: &apos;https:\/\/@@{PrismCentralIP}@@:9440\/api\/nutanix\/v3\/blueprints\/@@{app_deploy_blueprint_uuid}@@&apos;\n\nprintln(&quot;Status: &quot; + response.status)\n\/\/println(&quot;Content: &quot; + response.content)\n\ndef blueprint_spec = parseJSON(response.content)\ndef bp_index = 0\ndef var_index = 0\nblueprint_spec.remove(&apos;status&apos;)\nblueprint_spec[&apos;spec&apos;].remove(&apos;name&apos;)\nblueprint_spec[&apos;spec&apos;][&apos;application_name&apos;] = REPO_NAME + &apos;@@{calm_random}@@Jenkins&apos; + BUILD_NUMBER.toString()\nblueprint_spec[&apos;spec&apos;][&apos;app_profile_reference&apos;] = parseJSON(&apos;{&quot;kind&quot;: &quot;app_profile&quot;, &quot;uuid&quot;: &quot;34701768-60b4-a6f3-d97d-2a32de0f3cd5&quot;}&apos;)\nblueprint_spec[&apos;metadata&apos;][&apos;owner_reference&apos;] = parseJSON(&apos;{&quot;kind&quot;: &quot;user&quot;, &quot;uuid&quot;: &quot;00000000-0000-0000-0000-000000000000&quot;, &quot;name&quot;: &quot;admin&quot;}&apos;)\nblueprint_spec[&apos;spec&apos;][&apos;resources&apos;][&apos;app_profile_list&apos;].each  { profileKey, profileRow -&gt; \n    println(&quot;Profile: ${profileKey}&quot;); \n    profileKey[&apos;variable_list&apos;].each { variableKey, variableRow -&gt;\n        println(&quot;Variable: ${variableKey}&quot;); \n        if (variableKey[&apos;name&apos;] == &apos;dev_project&apos;){\n                blueprint_spec[&apos;spec&apos;][&apos;resources&apos;][&apos;app_profile_list&apos;][bp_index][&apos;variable_list&apos;][var_index][&apos;value&apos;] = REPO_NAME + BUILD_NUMBER.toString()\n        } else if (variableKey[&apos;name&apos;] == &apos;artifactory_ip&apos;){\n                blueprint_spec[&apos;spec&apos;][&apos;resources&apos;][&apos;app_profile_list&apos;][bp_index][&apos;variable_list&apos;][var_index][&apos;value&apos;] = ARTIFACTORY_IP\n        }\n        var_index += 1;\n    }; \n    bp_index += 1;\n}\n\/\/println(&quot;Content: &quot; + blueprint_spec)\n\ndef payload = JsonOutput.toJson(blueprint_spec)\nprintln(&quot;Payload: &quot; + payload)\n\ndef result = httpRequest authentication: &apos;PC-User&apos;, consoleLogResponseBody: true, customHeaders: [[maskValue: false, name: &apos;Content-Type&apos;, value: &apos;application\/json&apos;], [maskValue: false, name: &apos;Accept&apos;, value: &apos;application\/json&apos;]], httpMode: &apos;POST&apos;, requestBody: payload, ignoreSslErrors: true, responseHandle: &apos;LEAVE_OPEN&apos;, url: &apos;https:\/\/@@{PrismCentralIP}@@:9440\/api\/nutanix\/v3\/blueprints\/@@{app_deploy_blueprint_uuid}@@\/launch&apos;\nprintln(&quot;Status: &quot; + response.status)\nprintln(&quot;Content: &quot; + response.content)\n\ndef parseJSON(json) {\n    return new groovy.json.JsonSlurperClassic().parseText(json)\n}\n<\/script>\n    <sandbox>true<\/sandbox>\n  <\/definition>\n  <triggers\/>\n  <disabled>false<\/disabled>\n<\/flow-definition>'  | sudo su -c 'tee ~\/jobs\/deploy\/config.xml' - jenkins\n\nsudo su -c 'chmod 644 ~\/jobs\/deploy\/config.xml' - jenkins\nsudo su -c 'chmod 644 ~\/jobs\/deploy\/nextBuildNumber' - jenkins\nsudo su -c 'chmod 644 ~\/jobs\/deploy\/builds\/legacyIds' - jenkins\n\necho \"@@{DockerRegistry.address}@@ @@{DockerRegistry.name}@@.@@{domain_name}@@ @@{DockerRegistry.name}@@\" | sudo tee -a \/etc\/hosts\necho \"@@{GitoLite.address}@@ @@{GitoLite.name}@@.@@{domain_name}@@ @@{GitoLite.name}@@\" | sudo tee -a \/etc\/hosts\necho \"@@{Artifactory.address}@@ artifactory.@@{domain_name}@@ artifactory\" | sudo tee -a \/etc\/hosts\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"centos"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"a2a4eeaa_runbook","main_task_local_reference":{"kind":"app_task","name":"8dcc1fb7_dag"},"variable_list":[]},"name":"Initial Jenkins Config"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Task1"}],"name":"d204a48c_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Task1","attrs":{"exit_status":[],"script":"echo 'StrictHostKeyChecking no' > ~\/.ssh\/config\necho \"Create Hook\"\nssh @@{GitoLite.address}@@ 'printf \"#!\/bin\/bash\\n\/usr\/bin\/curl --user admin:@@{jenkins_authorization}@@ -s http:\/\/@@{address}@@:8080\/job\/devops\/buildWithParameters?token=ThisIsTheAPITokenToUse\\n\" | sudo su -c \"tee ~\/repositories\/devops.git\/hooks\/post-receive\" - git'\nssh @@{GitoLite.address}@@ 'sudo su -c \"chmod 775 ~\/repositories\/devops.git\/hooks\/post-receive\" - git'\necho \"Complete Hook\"","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"centos"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"c2477385_runbook","main_task_local_reference":{"kind":"app_task","name":"d204a48c_dag"},"variable_list":[]},"name":"Create Git Hook"}],"depends_on_list":[],"name":"Jenkins Master","port_list":[],"tier":"","variable_list":[{"val_type":"STRING","description":"","name":"jenkins_ssh_key_pub","type":"LOCAL","value":"","label":"","attrs":{"type":""}},{"val_type":"STRING","description":"","name":"jenkins_authorization","type":"LOCAL","value":"","label":"","attrs":{"type":""}},{"val_type":"STRING","description":"","name":"app_deploy_blueprint_uuid","type":"LOCAL","value":"","label":"","attrs":{"type":""}}],"description":""},{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Slave"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"cedd2a9f_dag_cloned_1_cloned_1_cloned_1","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"d9aa452b_runbook_cloned_1_cloned_2_cloned_1","main_task_local_reference":{"kind":"app_task","name":"cedd2a9f_dag_cloned_1_cloned_1_cloned_1"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Slave"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"2e59a97c_dag_cloned_1_cloned_1_cloned_1","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"2a1f7d12_runbook_cloned_1_cloned_2_cloned_1","main_task_local_reference":{"kind":"app_task","name":"2e59a97c_dag_cloned_1_cloned_1_cloned_1"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Slave"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"5242af7c_dag_cloned_1_cloned_1_cloned_1","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"467abe3f_runbook_cloned_1_cloned_2_cloned_1","main_task_local_reference":{"kind":"app_task","name":"5242af7c_dag_cloned_1_cloned_1_cloned_1"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Slave"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"ac646600_dag_cloned_1_cloned_1_cloned_1","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"249fd947_runbook_cloned_1_cloned_2_cloned_1","main_task_local_reference":{"kind":"app_task","name":"ac646600_dag_cloned_1_cloned_1_cloned_1"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Slave"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"34e772eb_dag_cloned_1_cloned_1_cloned_1","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"d85613e3_runbook_cloned_1_cloned_2_cloned_1","main_task_local_reference":{"kind":"app_task","name":"34e772eb_dag_cloned_1_cloned_1_cloned_1"},"variable_list":[]},"name":"action_restart"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Install Jenkins CLI"},{"kind":"app_task","name":"Configure Jenkins Slave"}],"name":"0042d60a_dag_cloned_1","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Install Jenkins CLI"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Configure Jenkins Slave"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Slave"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Install Jenkins CLI","attrs":{"exit_status":[],"script":"### Install Jekins-Cli via local download from master\ncurl -sL http:\/\/@@{Jenkins Master.address}@@:8080\/jnlpJars\/jenkins-cli.jar -o jenkins-cli.jar","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"centos"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Slave"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Configure Jenkins Slave","attrs":{"exit_status":[],"script":"JENKINS_URL=http:\/\/@@{Jenkins Master.address}@@:8080\nNODE_NAME=@@{name}@@\nNODE_IP=@@{address}@@\nNODE_SLAVE_HOME='\/home\/centos'\nEXECUTORS=1\nSSH_PORT=22\nCRED_ID=Jenkins-Slave\nLABELS=build\nUSERID=admin\n\necho \"Creating credential\"\necho '<com.cloudbees.plugins.credentials.impl.UsernamePasswordCredentialsImpl>\n  <scope>GLOBAL<\/scope>\n  <id>Jenkins-Slave<\/id>\n  <description>Slave Login<\/description>\n  <username>@@{centos.username}@@<\/username>\n  <password>@@{centos.secret}@@<\/password>\n<\/com.cloudbees.plugins.credentials.impl.UsernamePasswordCredentialsImpl>' | sudo java -jar \/home\/centos\/jenkins-cli.jar -auth admin:@@{Jenkins Master.jenkins_authorization}@@ -s http:\/\/@@{Jenkins Master.address}@@:8080  create-credentials-by-xml system::system::jenkins _ \n\necho \"Creating slave node\"\ncat <<EOF | sudo java -jar ${NODE_SLAVE_HOME}\/jenkins-cli.jar -auth admin:@@{Jenkins Master.jenkins_authorization}@@ -s ${JENKINS_URL} create-node ${NODE_NAME}\n<slave>\n  <name>${NODE_NAME}<\/name>\n  <description>Jenkins Slave Node<\/description>\n  <remoteFS>${NODE_SLAVE_HOME}<\/remoteFS>\n  <numExecutors>${EXECUTORS}<\/numExecutors>\n  <mode>NORMAL<\/mode>\n  <launcher class=\"hudson.plugins.sshslaves.SSHLauncher\" plugin=\"ssh-slaves\">\n    <host>${NODE_IP}<\/host>\n    <port>${SSH_PORT}<\/port>\n    <credentialsId>${CRED_ID}<\/credentialsId>\n    <maxNumRetries>0<\/maxNumRetries>\n    <retryWaitTime>0<\/retryWaitTime>\n    <sshHostKeyVerificationStrategy class=\"hudson.plugins.sshslaves.verifiers.NonVerifyingKeyVerificationStrategy\"\/>\n  <\/launcher>\n  <label>${LABELS}<\/label>\n  <nodeProperties\/>\n<\/slave>\nEOF","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"centos"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"5ea2d4b5_runbook_cloned_1","main_task_local_reference":{"kind":"app_task","name":"0042d60a_dag_cloned_1"},"variable_list":[]},"name":"Configure Jenkins Slave"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Configure Connectivity"}],"name":"75eab6d7_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Slave"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Configure Connectivity","attrs":{"exit_status":[],"script":"mkdir ~\/.ssh\nchmod 700 ~\/.ssh\ncp @@{birth_project}@@\/keys\/id_calm_rsa ~\/.ssh\/id_rsa\ncp @@{birth_project}@@\/keys\/id_calm_rsa.pub ~\/.ssh\/id_rsa.pub\nchmod 600 ~\/.ssh\/id_rsa\nchmod 600 ~\/.ssh\/id_rsa.pub\nsudo mkdir \/usr\/local\/share\/ca-certificates\/docker-dev-cert\nREGISTRY_IP=@@{DockerRegistry.address}@@\nsshpass -p @@{centos.secret}@@ scp -oStrictHostKeyChecking=no ${REGISTRY_IP}:~\/devdockerCA.crt \/tmp\nsudo mv \/tmp\/devdockerCA.crt \/usr\/local\/share\/ca-certificates\/docker-dev-cert\/devdockerCA.crt\nsudo update-ca-certificates\nsudo service docker restart\necho \"@@{DockerRegistry.address}@@ @@{DockerRegistry.name}@@.@@{domain_name}@@ @@{DockerRegistry.name}@@\" | sudo tee -a \/etc\/hosts\necho \"@@{GitoLite.address}@@ @@{GitoLite.name}@@.@@{domain_name}@@ @@{GitoLite.name}@@\" | sudo tee -a \/etc\/hosts\necho \"@@{Artifactory.address}@@ artifactory.@@{domain_name}@@ artifactory\" | sudo tee -a \/etc\/hosts\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"centos"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"101252c7_runbook","main_task_local_reference":{"kind":"app_task","name":"75eab6d7_dag"},"variable_list":[]},"name":"Configure Connectivity"}],"depends_on_list":[],"name":"Jenkins Slave","port_list":[],"tier":"","variable_list":[],"description":""}],"substrate_definition_list":[{"description":"","action_list":[],"type":"AHV_VM","name":"WorkstationVM","readiness_probe":{"connection_type":"SSH","disable_readiness_probe":false,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"60","connection_port":22,"login_credential_local_reference":{"kind":"app_credential","name":"centos"}},"editables":{"create_spec":{"resources":{"nic_list":{},"serial_port_list":{},"disk_list":{}}}},"os_type":"Linux","create_spec":{"name":"dev-workstation-@@{calm_random}@@","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"33c97f77-2afd-4331-a2cc-542934091a48"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":1,"gpu_list":[],"memory_size_mib":1024,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\noutput: {all: '| tee -a \/var\/log\/cloud-init-output.log'}\nfqdn: @@{name}@@.ntnx.local\nmanage_etc_hosts: true\nhostname: @@{name}@@\npackage_upgrade: true\nuser: centos\npassword: centos\nchpasswd: { expire: False}\nssh_pwauth: True\nusers:\n - name: centos\n   sudo: ['ALL=(ALL) NOPASSWD:ALL']\n   ssh-authorized-keys:\n     - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQCle6\/np\/b7emBki+KeDJ7r3BNqdeGqewX\/ziXfD5Fv\/hbt\/dkp4zSAtH3XmfAZCC6g2vmar47D6b3VZRtC1yt71jNCgfGgvh\/rwgZ8pZPZT\/DE3FGSiAbeXhbrTTusNu3sZOqT9NQOCxevQuaqQ0uw7PN0exNykiPE5T\/L1vY+0r+ReOJOqomoFpHukCtJqr4eE1AJb4WM\/kZgLABnA7yYvEloDP5cNpP3SLbK+3nbW7rCjwaq0Swx80p8Gm8XkkRFeoXEyQr1d6Wf7PErenhU8a11wuDkEGODhBX+YrnokhL5j7wtRn2Ze1JJRZTlEyA7l2fVa7uBvK0\/WBb7phC8cvcNQ9lxh0gJlWJpO3AdshJm9uhhIOsEke7KuI6IN1qpGOzAa7xxDwVwp7BiI34PvrgP18\/hb1yPAKsiuf2PoJBn5MHCC6q1j9WWKM0O2ozojFPK\/DH80jsNLPGQb2r+cpJoXA8XAm9CkRKjU1b71f0zRG6Ku7WiOqq4BpLFbpQrFaXbWYAxzLB6HSBVeukrS7gxKeP+h5ByWr3dE0AsIb+QbPvyzfT4IGr8G4BzySQfLp4XM1RCVAOKz10JUIvP0MTwj9C8zrVUvEzHF1WMQMyHtpo\/\/BWDOWrw1xt\/xyeTZaQtPuD6Gylt9pO4TtQMBiOSW7BcfS8BxnvCPxR\/kQ== thomas@thomas-findelkind.de\nruncmd:\n - echo 'Defaults:root !requiretty' > \/etc\/sudoers.d\/888-vagrant-cloud-init-requiretty"},"type":"","sysprep":null},"power_state":"ON","type":"","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"image","type":"","name":"CentOS-7-x86_64-GenericCloud.qcow2","uuid":"914cae5e-fa90-482b-9901-2ac64d344fd3"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":null,"type":"","disk_size_mib":102400,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":1,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":""},"variable_list":[]},{"description":"","action_list":[],"type":"AHV_VM","name":"GitoLiteVM","readiness_probe":{"connection_type":"SSH","disable_readiness_probe":false,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"60","connection_port":22,"login_credential_local_reference":{"kind":"app_credential","name":"centos"}},"editables":{"create_spec":{"resources":{"nic_list":{},"serial_port_list":{},"disk_list":{}}}},"os_type":"Linux","create_spec":{"name":"git-server-@@{calm_random}@@","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"33c97f77-2afd-4331-a2cc-542934091a48"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":1,"gpu_list":[],"memory_size_mib":1024,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\noutput: {all: '| tee -a \/var\/log\/cloud-init-output.log'}\nfqdn: @@{name}@@.ntnx.local\nmanage_etc_hosts: true\nhostname: @@{name}@@\npackage_upgrade: true\nuser: centos\npassword: centos\nchpasswd: { expire: False}\nssh_pwauth: True\nusers:\n - name: centos\n   sudo: ['ALL=(ALL) NOPASSWD:ALL']\n   ssh-authorized-keys:\n     - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQCle6\/np\/b7emBki+KeDJ7r3BNqdeGqewX\/ziXfD5Fv\/hbt\/dkp4zSAtH3XmfAZCC6g2vmar47D6b3VZRtC1yt71jNCgfGgvh\/rwgZ8pZPZT\/DE3FGSiAbeXhbrTTusNu3sZOqT9NQOCxevQuaqQ0uw7PN0exNykiPE5T\/L1vY+0r+ReOJOqomoFpHukCtJqr4eE1AJb4WM\/kZgLABnA7yYvEloDP5cNpP3SLbK+3nbW7rCjwaq0Swx80p8Gm8XkkRFeoXEyQr1d6Wf7PErenhU8a11wuDkEGODhBX+YrnokhL5j7wtRn2Ze1JJRZTlEyA7l2fVa7uBvK0\/WBb7phC8cvcNQ9lxh0gJlWJpO3AdshJm9uhhIOsEke7KuI6IN1qpGOzAa7xxDwVwp7BiI34PvrgP18\/hb1yPAKsiuf2PoJBn5MHCC6q1j9WWKM0O2ozojFPK\/DH80jsNLPGQb2r+cpJoXA8XAm9CkRKjU1b71f0zRG6Ku7WiOqq4BpLFbpQrFaXbWYAxzLB6HSBVeukrS7gxKeP+h5ByWr3dE0AsIb+QbPvyzfT4IGr8G4BzySQfLp4XM1RCVAOKz10JUIvP0MTwj9C8zrVUvEzHF1WMQMyHtpo\/\/BWDOWrw1xt\/xyeTZaQtPuD6Gylt9pO4TtQMBiOSW7BcfS8BxnvCPxR\/kQ== thomas@thomas-findelkind.de\nruncmd:\n - echo 'Defaults:root !requiretty' > \/etc\/sudoers.d\/888-vagrant-cloud-init-requiretty"},"type":"","sysprep":null},"power_state":"ON","type":"","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"image","type":"","name":"CentOS-7-x86_64-GenericCloud.qcow2","uuid":"914cae5e-fa90-482b-9901-2ac64d344fd3"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":null,"type":"","disk_size_mib":102400,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":1,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":""},"variable_list":[]},{"description":"","action_list":[],"type":"AHV_VM","name":"ArtifactoryVM","readiness_probe":{"connection_type":"SSH","disable_readiness_probe":false,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"60","connection_port":22,"login_credential_local_reference":{"kind":"app_credential","name":"centos"}},"editables":{"create_spec":{"resources":{"nic_list":{},"serial_port_list":{},"disk_list":{}}}},"os_type":"Linux","create_spec":{"name":"artifactory-@@{calm_random}@@","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"33c97f77-2afd-4331-a2cc-542934091a48"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":1,"gpu_list":[],"memory_size_mib":1024,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\noutput: {all: '| tee -a \/var\/log\/cloud-init-output.log'}\nfqdn: @@{name}@@.ntnx.local\nmanage_etc_hosts: true\nhostname: @@{name}@@\npackage_upgrade: true\nuser: centos\npassword: centos\nchpasswd: { expire: False}\nssh_pwauth: True\nusers:\n - name: centos\n   sudo: ['ALL=(ALL) NOPASSWD:ALL']\n   ssh-authorized-keys:\n     - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQCle6\/np\/b7emBki+KeDJ7r3BNqdeGqewX\/ziXfD5Fv\/hbt\/dkp4zSAtH3XmfAZCC6g2vmar47D6b3VZRtC1yt71jNCgfGgvh\/rwgZ8pZPZT\/DE3FGSiAbeXhbrTTusNu3sZOqT9NQOCxevQuaqQ0uw7PN0exNykiPE5T\/L1vY+0r+ReOJOqomoFpHukCtJqr4eE1AJb4WM\/kZgLABnA7yYvEloDP5cNpP3SLbK+3nbW7rCjwaq0Swx80p8Gm8XkkRFeoXEyQr1d6Wf7PErenhU8a11wuDkEGODhBX+YrnokhL5j7wtRn2Ze1JJRZTlEyA7l2fVa7uBvK0\/WBb7phC8cvcNQ9lxh0gJlWJpO3AdshJm9uhhIOsEke7KuI6IN1qpGOzAa7xxDwVwp7BiI34PvrgP18\/hb1yPAKsiuf2PoJBn5MHCC6q1j9WWKM0O2ozojFPK\/DH80jsNLPGQb2r+cpJoXA8XAm9CkRKjU1b71f0zRG6Ku7WiOqq4BpLFbpQrFaXbWYAxzLB6HSBVeukrS7gxKeP+h5ByWr3dE0AsIb+QbPvyzfT4IGr8G4BzySQfLp4XM1RCVAOKz10JUIvP0MTwj9C8zrVUvEzHF1WMQMyHtpo\/\/BWDOWrw1xt\/xyeTZaQtPuD6Gylt9pO4TtQMBiOSW7BcfS8BxnvCPxR\/kQ== thomas@thomas-findelkind.de\nruncmd:\n - echo 'Defaults:root !requiretty' > \/etc\/sudoers.d\/888-vagrant-cloud-init-requiretty"},"type":"","sysprep":null},"power_state":"ON","type":"","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"image","type":"","name":"CentOS-7-x86_64-GenericCloud.qcow2","uuid":"914cae5e-fa90-482b-9901-2ac64d344fd3"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":null,"type":"","disk_size_mib":102400,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":1,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":""},"variable_list":[]},{"description":"","action_list":[],"type":"AHV_VM","name":"DockerRegistryVM","readiness_probe":{"connection_type":"SSH","disable_readiness_probe":false,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"60","connection_port":22,"login_credential_local_reference":{"kind":"app_credential","name":"centos"}},"editables":{"create_spec":{"resources":{"nic_list":{},"serial_port_list":{},"disk_list":{}}}},"os_type":"Linux","create_spec":{"name":"docker-registry-@@{calm_random}@@","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"33c97f77-2afd-4331-a2cc-542934091a48"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":4,"gpu_list":[],"memory_size_mib":4096,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\noutput: {all: '| tee -a \/var\/log\/cloud-init-output.log'}\nfqdn: @@{name}@@.ntnx.local\nmanage_etc_hosts: true\nhostname: @@{name}@@\npackage_upgrade: true\nuser: centos\npassword: centos\nchpasswd: { expire: False}\nssh_pwauth: True\nusers:\n - name: centos\n   sudo: ['ALL=(ALL) NOPASSWD:ALL']\n   ssh-authorized-keys:\n     - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQCle6\/np\/b7emBki+KeDJ7r3BNqdeGqewX\/ziXfD5Fv\/hbt\/dkp4zSAtH3XmfAZCC6g2vmar47D6b3VZRtC1yt71jNCgfGgvh\/rwgZ8pZPZT\/DE3FGSiAbeXhbrTTusNu3sZOqT9NQOCxevQuaqQ0uw7PN0exNykiPE5T\/L1vY+0r+ReOJOqomoFpHukCtJqr4eE1AJb4WM\/kZgLABnA7yYvEloDP5cNpP3SLbK+3nbW7rCjwaq0Swx80p8Gm8XkkRFeoXEyQr1d6Wf7PErenhU8a11wuDkEGODhBX+YrnokhL5j7wtRn2Ze1JJRZTlEyA7l2fVa7uBvK0\/WBb7phC8cvcNQ9lxh0gJlWJpO3AdshJm9uhhIOsEke7KuI6IN1qpGOzAa7xxDwVwp7BiI34PvrgP18\/hb1yPAKsiuf2PoJBn5MHCC6q1j9WWKM0O2ozojFPK\/DH80jsNLPGQb2r+cpJoXA8XAm9CkRKjU1b71f0zRG6Ku7WiOqq4BpLFbpQrFaXbWYAxzLB6HSBVeukrS7gxKeP+h5ByWr3dE0AsIb+QbPvyzfT4IGr8G4BzySQfLp4XM1RCVAOKz10JUIvP0MTwj9C8zrVUvEzHF1WMQMyHtpo\/\/BWDOWrw1xt\/xyeTZaQtPuD6Gylt9pO4TtQMBiOSW7BcfS8BxnvCPxR\/kQ== thomas@thomas-findelkind.de\nruncmd:\n - echo 'Defaults:root !requiretty' > \/etc\/sudoers.d\/888-vagrant-cloud-init-requiretty"},"type":"","sysprep":null},"power_state":"ON","type":"","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"image","type":"","name":"CentOS-7-x86_64-GenericCloud.qcow2","uuid":"914cae5e-fa90-482b-9901-2ac64d344fd3"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":null,"type":"","disk_size_mib":102400,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":1,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":""},"variable_list":[]},{"description":"","action_list":[],"type":"AHV_VM","name":"JenkinsMasterVM","readiness_probe":{"connection_type":"SSH","disable_readiness_probe":false,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"60","connection_port":22,"login_credential_local_reference":{"kind":"app_credential","name":"centos"}},"editables":{"create_spec":{"resources":{"nic_list":{},"serial_port_list":{},"disk_list":{}}}},"os_type":"Linux","create_spec":{"name":"jenkins-master-@@{calm_random}@@","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"33c97f77-2afd-4331-a2cc-542934091a48"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":1,"gpu_list":[],"memory_size_mib":1024,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\noutput: {all: '| tee -a \/var\/log\/cloud-init-output.log'}\nfqdn: @@{name}@@.ntnx.local\nmanage_etc_hosts: true\nhostname: @@{name}@@\npackage_upgrade: true\nuser: centos\npassword: centos\nchpasswd: { expire: False}\nssh_pwauth: True\nusers:\n - name: centos\n   sudo: ['ALL=(ALL) NOPASSWD:ALL']\n   ssh-authorized-keys:\n     - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQCle6\/np\/b7emBki+KeDJ7r3BNqdeGqewX\/ziXfD5Fv\/hbt\/dkp4zSAtH3XmfAZCC6g2vmar47D6b3VZRtC1yt71jNCgfGgvh\/rwgZ8pZPZT\/DE3FGSiAbeXhbrTTusNu3sZOqT9NQOCxevQuaqQ0uw7PN0exNykiPE5T\/L1vY+0r+ReOJOqomoFpHukCtJqr4eE1AJb4WM\/kZgLABnA7yYvEloDP5cNpP3SLbK+3nbW7rCjwaq0Swx80p8Gm8XkkRFeoXEyQr1d6Wf7PErenhU8a11wuDkEGODhBX+YrnokhL5j7wtRn2Ze1JJRZTlEyA7l2fVa7uBvK0\/WBb7phC8cvcNQ9lxh0gJlWJpO3AdshJm9uhhIOsEke7KuI6IN1qpGOzAa7xxDwVwp7BiI34PvrgP18\/hb1yPAKsiuf2PoJBn5MHCC6q1j9WWKM0O2ozojFPK\/DH80jsNLPGQb2r+cpJoXA8XAm9CkRKjU1b71f0zRG6Ku7WiOqq4BpLFbpQrFaXbWYAxzLB6HSBVeukrS7gxKeP+h5ByWr3dE0AsIb+QbPvyzfT4IGr8G4BzySQfLp4XM1RCVAOKz10JUIvP0MTwj9C8zrVUvEzHF1WMQMyHtpo\/\/BWDOWrw1xt\/xyeTZaQtPuD6Gylt9pO4TtQMBiOSW7BcfS8BxnvCPxR\/kQ== thomas@thomas-findelkind.de\nruncmd:\n - echo 'Defaults:root !requiretty' > \/etc\/sudoers.d\/888-vagrant-cloud-init-requiretty"},"type":"","sysprep":null},"power_state":"ON","type":"","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"image","type":"","name":"CentOS-7-x86_64-GenericCloud.qcow2","uuid":"914cae5e-fa90-482b-9901-2ac64d344fd3"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":null,"type":"","disk_size_mib":102400,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":1,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":""},"variable_list":[]},{"description":"","action_list":[],"type":"AHV_VM","name":"JenkinsSlaveVM","readiness_probe":{"connection_type":"SSH","disable_readiness_probe":false,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"60","connection_port":22,"login_credential_local_reference":{"kind":"app_credential","name":"centos"}},"editables":{"create_spec":{"resources":{"nic_list":{},"serial_port_list":{},"disk_list":{}}}},"os_type":"Linux","create_spec":{"name":"jenkins-slave-@@{calm_random}@@","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"33c97f77-2afd-4331-a2cc-542934091a48"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":4,"gpu_list":[],"memory_size_mib":4096,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\noutput: {all: '| tee -a \/var\/log\/cloud-init-output.log'}\nfqdn: @@{name}@@.ntnx.local\nmanage_etc_hosts: true\nhostname: @@{name}@@\npackage_upgrade: true\nuser: centos\npassword: centos\nchpasswd: { expire: False}\nssh_pwauth: True\nusers:\n - name: centos\n   sudo: ['ALL=(ALL) NOPASSWD:ALL']\n   ssh-authorized-keys:\n     - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQCle6\/np\/b7emBki+KeDJ7r3BNqdeGqewX\/ziXfD5Fv\/hbt\/dkp4zSAtH3XmfAZCC6g2vmar47D6b3VZRtC1yt71jNCgfGgvh\/rwgZ8pZPZT\/DE3FGSiAbeXhbrTTusNu3sZOqT9NQOCxevQuaqQ0uw7PN0exNykiPE5T\/L1vY+0r+ReOJOqomoFpHukCtJqr4eE1AJb4WM\/kZgLABnA7yYvEloDP5cNpP3SLbK+3nbW7rCjwaq0Swx80p8Gm8XkkRFeoXEyQr1d6Wf7PErenhU8a11wuDkEGODhBX+YrnokhL5j7wtRn2Ze1JJRZTlEyA7l2fVa7uBvK0\/WBb7phC8cvcNQ9lxh0gJlWJpO3AdshJm9uhhIOsEke7KuI6IN1qpGOzAa7xxDwVwp7BiI34PvrgP18\/hb1yPAKsiuf2PoJBn5MHCC6q1j9WWKM0O2ozojFPK\/DH80jsNLPGQb2r+cpJoXA8XAm9CkRKjU1b71f0zRG6Ku7WiOqq4BpLFbpQrFaXbWYAxzLB6HSBVeukrS7gxKeP+h5ByWr3dE0AsIb+QbPvyzfT4IGr8G4BzySQfLp4XM1RCVAOKz10JUIvP0MTwj9C8zrVUvEzHF1WMQMyHtpo\/\/BWDOWrw1xt\/xyeTZaQtPuD6Gylt9pO4TtQMBiOSW7BcfS8BxnvCPxR\/kQ== thomas@thomas-findelkind.de\nruncmd:\n - echo 'Defaults:root !requiretty' > \/etc\/sudoers.d\/888-vagrant-cloud-init-requiretty"},"type":"","sysprep":null},"power_state":"ON","type":"","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"image","type":"","name":"CentOS-7-x86_64-GenericCloud.qcow2","uuid":"914cae5e-fa90-482b-9901-2ac64d344fd3"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":null,"type":"","disk_size_mib":102400,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":1,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":""},"variable_list":[]}],"credential_definition_list":[{"username":"centos","description":"","type":"PASSWORD","secret":{"attrs":{"is_secret_modified":false,"secret_reference":{}}},"name":"centos"},{"username":"admin","description":"","type":"PASSWORD","secret":{"attrs":{"is_secret_modified":false,"secret_reference":{}}},"name":"PrismCentral"}],"package_definition_list":[{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"Developer Workstation"}],"name":"InstallWokstationVM","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"InstallWokstationVM"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[{"kind":"app_task","name":"Wait_CloudInit"},{"kind":"app_task","name":"Birth_CIFS"},{"kind":"app_task","name":"PrepareLocalRepos_Workstation"},{"kind":"app_task","name":"Install docker"},{"kind":"app_task","name":"Install docker compose"},{"kind":"app_task","name":"Install NodeJS"}],"name":"8f71dd71_dag","state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Wait_CloudInit"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Birth_CIFS"}},{"from_task_reference":{"kind":"app_task","name":"Birth_CIFS"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"PrepareLocalRepos_Workstation"}},{"from_task_reference":{"kind":"app_task","name":"PrepareLocalRepos_Workstation"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Install docker"}},{"from_task_reference":{"kind":"app_task","name":"Install docker"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Install docker compose"}},{"from_task_reference":{"kind":"app_task","name":"Install docker compose"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Install NodeJS"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Developer Workstation"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Wait_CloudInit","state":"ACTIVE","attrs":{"exit_status":[],"script":"# Wait until cloud-init finished\nwhile [ ! -f \/var\/lib\/cloud\/instance\/boot-finished ]\ndo\n  sleep 1\ndone\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"centos"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Developer Workstation"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Birth_CIFS","state":"ACTIVE","attrs":{"exit_status":[],"script":"#mount smb share\nsudo mkdir \/mnt\/birth\necho '\/\/192.168.178.98\/iso \/mnt\/birth\tcifs\tusername=tfindelk,password=Timspw1c!' | sudo tee -a \/etc\/fstab\nsudo mount -a\n\n# Alternative insert CD\n\n\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"centos"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Developer Workstation"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"PrepareLocalRepos_Workstation","state":"ACTIVE","attrs":{"exit_status":[],"script":"# Get rid off old repos \nsudo mkdir \/etc\/yum.repos.d\/old\nsudo mv \/etc\/yum.repos.d\/*.repo \/etc\/yum.repos.d\/old\n\n# Create repos from birth directory\n\n# Centos 7 Base repos (base,updates,extra,centosplus)\necho '\n# CentOS-Base.repo\n#\n# The mirror system uses the connecting IP address of the client and the\n# update status of each mirror to pick mirrors that are updated to and\n# geographically close to the client.  You should use this for CentOS updates\n# unless you are manually picking other mirrors.\n#\n# If the mirrorlist= does not work for you, as a fall back you can try the \n# remarked out baseurl= line instead.\n#\n#\n\n[base]\nname=CentOS-$releasever - Base\nbaseurl=file:\/\/@@{birth_project}@@\/repos\/base\ngpgcheck=1\ngpgkey=file:\/\/\/etc\/pki\/rpm-gpg\/RPM-GPG-KEY-CentOS-7\n\n#released updates \n[updates]\nname=CentOS-$releasever - Updates\nbaseurl=file:\/\/@@{birth_project}@@\/repos\/updates\ngpgcheck=1\ngpgkey=file:\/\/\/etc\/pki\/rpm-gpg\/RPM-GPG-KEY-CentOS-7\n\n#additional packages that may be useful\n[extras]\nname=CentOS-$releasever - Extras\nbaseurl=file:\/\/@@{birth_project}@@\/repos\/extras\ngpgcheck=1\ngpgkey=file:\/\/\/etc\/pki\/rpm-gpg\/RPM-GPG-KEY-CentOS-7\n\n#additional packages that extend functionality of existing packages\n[centosplus]\nname=CentOS-$releasever - Plus\nbaseurl=file:\/\/@@{birth_project}@@\/repos\/centosplus\ngpgcheck=1\nenabled=1\ngpgkey=file:\/\/\/etc\/pki\/rpm-gpg\/RPM-GPG-KEY-CentOS-7\n\n[epel]\nname=Extra Packages for Enterprise Linux 7 - $basearch\nbaseurl=file:\/\/@@{birth_project}@@\/repos\/epel\nfailovermethod=priority\nenabled=1\ngpgcheck=0\ngpgkey=file:\/\/\/etc\/pki\/rpm-gpg\/RPM-GPG-KEY-EPEL-7' | sudo tee -a \/etc\/yum.repos.d\/CentOS-Base.repo\n\n# Docker CE stable repos\necho '\n[docker-ce-stable]\nname=Docker CE Stable\nbaseurl=file:\/\/@@{birth_project}@@\/repos\/docker-ce-stable\/Packages\ngpgcheck=0\nenabled=1' | sudo tee -a \/etc\/yum.repos.d\/docker-ce-stable.repo\n\n\n\n# make sure cache is updated\nsudo yum makecache","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"centos"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Developer Workstation"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Install docker","state":"ACTIVE","attrs":{"exit_status":[],"script":"# Install docker\nsudo yum install -y docker-ce\n\n# Start docker\nsudo systemctl start docker\n\n# Make sure docker service starts with system\nsudo systemctl enable docker\n\n# Enable user centos to use docker without sudo\nsudo usermod -aG docker centos","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"centos"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Developer Workstation"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Install docker compose","state":"ACTIVE","attrs":{"exit_status":[],"script":"### Install docker compose\nsudo cp @@{birth_project}@@\/downloads\/docker-compose \/usr\/local\/bin\/ \nsudo chmod +x \/usr\/local\/bin\/docker-compose","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"centos"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Developer Workstation"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Install NodeJS","state":"ACTIVE","attrs":{"exit_status":[],"script":"# Install nodejs\nsudo yum install -y nodejs","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"centos"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"97c81fe3_runbook","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"8f71dd71_dag"},"message_list":[],"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"InstallWokstationVM"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"4c070a87_dag","state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"c775740d_runbook","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"4c070a87_dag"},"message_list":[],"variable_list":[]}},"variable_list":[]},{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"GitoLite"}],"name":"InstallGitoLiteVM","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"InstallGitoLiteVM"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[{"kind":"app_task","name":"Wait_CloudInit"},{"kind":"app_task","name":"Birth_CIFS"},{"kind":"app_task","name":"PrepareLocalRepos_GitoLite"},{"kind":"app_task","name":"Install GitoLite"}],"name":"8f71dd71_dag_cloned_1","state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Wait_CloudInit"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Birth_CIFS"}},{"from_task_reference":{"kind":"app_task","name":"Birth_CIFS"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"PrepareLocalRepos_GitoLite"}},{"from_task_reference":{"kind":"app_task","name":"PrepareLocalRepos_GitoLite"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Install GitoLite"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"GitoLite"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Wait_CloudInit","state":"ACTIVE","attrs":{"exit_status":[],"script":"# Wait until cloud-init finished\nwhile [ ! -f \/var\/lib\/cloud\/instance\/boot-finished ]\ndo\n  sleep 1\ndone\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"centos"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"GitoLite"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Birth_CIFS","state":"ACTIVE","attrs":{"exit_status":[],"script":"#mount smb share\nsudo mkdir \/mnt\/birth\necho '\/\/192.168.178.98\/iso \/mnt\/birth\tcifs\tusername=tfindelk,password=Timspw1c!' | sudo tee -a \/etc\/fstab\nsudo mount -a\n\n# Alternative insert CD\n\n\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"centos"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"GitoLite"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"PrepareLocalRepos_GitoLite","state":"ACTIVE","attrs":{"exit_status":[],"script":"# Get rid off old repos \nsudo mkdir \/etc\/yum.repos.d\/old\nsudo mv \/etc\/yum.repos.d\/*.repo \/etc\/yum.repos.d\/old\n\n# Create repos from birth directory\n\n# Centos 7 Base repos (base,updates,extra,centosplus)\necho '\n# CentOS-Base.repo\n#\n# The mirror system uses the connecting IP address of the client and the\n# update status of each mirror to pick mirrors that are updated to and\n# geographically close to the client.  You should use this for CentOS updates\n# unless you are manually picking other mirrors.\n#\n# If the mirrorlist= does not work for you, as a fall back you can try the \n# remarked out baseurl= line instead.\n#\n#\n\n[base]\nname=CentOS-$releasever - Base\nbaseurl=file:\/\/@@{birth_project}@@\/repos\/base\ngpgcheck=1\ngpgkey=file:\/\/\/etc\/pki\/rpm-gpg\/RPM-GPG-KEY-CentOS-7\n\n#released updates \n[updates]\nname=CentOS-$releasever - Updates\nbaseurl=file:\/\/@@{birth_project}@@\/repos\/updates\ngpgcheck=1\ngpgkey=file:\/\/\/etc\/pki\/rpm-gpg\/RPM-GPG-KEY-CentOS-7\n\n#additional packages that may be useful\n[extras]\nname=CentOS-$releasever - Extras\nbaseurl=file:\/\/@@{birth_project}@@\/repos\/extras\ngpgcheck=1\ngpgkey=file:\/\/\/etc\/pki\/rpm-gpg\/RPM-GPG-KEY-CentOS-7\n\n#additional packages that extend functionality of existing packages\n[centosplus]\nname=CentOS-$releasever - Plus\nbaseurl=file:\/\/@@{birth_project}@@\/repos\/centosplus\ngpgcheck=1\nenabled=1\ngpgkey=file:\/\/\/etc\/pki\/rpm-gpg\/RPM-GPG-KEY-CentOS-7\n\n[epel]\nname=Extra Packages for Enterprise Linux 7 - $basearch\nbaseurl=file:\/\/@@{birth_project}@@\/repos\/epel\nfailovermethod=priority\nenabled=1\ngpgcheck=0\ngpgkey=file:\/\/\/etc\/pki\/rpm-gpg\/RPM-GPG-KEY-EPEL-7' | sudo tee -a \/etc\/yum.repos.d\/CentOS-Base.repo\n\n# Docker CE stable repos\necho '\n[docker-ce-stable]\nname=Docker CE Stable\nbaseurl=file:\/\/@@{birth_project}@@\/repos\/docker-ce-stable\/Packages\ngpgcheck=0\nenabled=1' | sudo tee -a \/etc\/yum.repos.d\/docker-ce-stable.repo\n\n\n\n# make sure cache is updated\nsudo yum makecache","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"centos"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"GitoLite"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Install GitoLite","state":"ACTIVE","attrs":{"exit_status":[],"script":"mkdir ~\/.ssh\nchmod 700 ~\/.ssh\necho 'set -o vi' >> ~\/.bashrc\necho 'StrictHostKeyChecking no' > ~\/.ssh\/config\nchmod 600 ~\/.ssh\/config\n\necho \"Copy SSH Keys\"\ncp @@{birth_project}@@\/keys\/id_calm_rsa ~\/.ssh\/id_rsa\ncp @@{birth_project}@@\/keys\/id_calm_rsa.pub ~\/.ssh\/id_rsa.pub\nchmod 600 ~\/.ssh\/id_*\ncp ~\/.ssh\/id_rsa.pub ~\/.ssh\/authorized_keys\ncp ~\/.ssh\/id_rsa.pub \/tmp\/nutanix.pub\nchmod 644 \/tmp\/nutanix.pub\n\nsudo yum install -y gitolite3\n\nsudo adduser git\nsudo passwd -d git\nsudo su -c 'mkdir ~\/bin; chmod 750 ~\/bin' - git\nsudo su -c 'echo \"PATH=$PATH:~\/bin\" >> ~\/.profile' - git\nsudo su -c 'gitolite setup -pk \/tmp\/nutanix.pub' - git\nrm \/tmp\/nutanix.pub\ngit clone git@@@{address}@@:gitolite-admin.git\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"centos"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"97c81fe3_runbook_cloned_1","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"8f71dd71_dag_cloned_1"},"message_list":[],"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"InstallGitoLiteVM"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"4c070a87_dag_cloned_1","state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"c775740d_runbook_cloned_1","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"4c070a87_dag_cloned_1"},"message_list":[],"variable_list":[]}},"variable_list":[]},{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"Artifactory"}],"name":"InstallArtifactoryVM","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"InstallArtifactoryVM"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[{"kind":"app_task","name":"Wait_CloudInit"},{"kind":"app_task","name":"Birth_CIFS"},{"kind":"app_task","name":"PrepareLocalRepos_Artifactory"},{"kind":"app_task","name":"Install Docker"},{"kind":"app_task","name":"Install Docker Compose"},{"kind":"app_task","name":"Install Artifactory"},{"kind":"app_task","name":"Start Artifactory"}],"name":"8f71dd71_dag_cloned_1_cloned_1","state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Wait_CloudInit"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Birth_CIFS"}},{"from_task_reference":{"kind":"app_task","name":"Birth_CIFS"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"PrepareLocalRepos_Artifactory"}},{"from_task_reference":{"kind":"app_task","name":"PrepareLocalRepos_Artifactory"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Install Docker"}},{"from_task_reference":{"kind":"app_task","name":"Install Docker"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Install Docker Compose"}},{"from_task_reference":{"kind":"app_task","name":"Install Docker Compose"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Install Artifactory"}},{"from_task_reference":{"kind":"app_task","name":"Install Artifactory"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Start Artifactory"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Artifactory"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Wait_CloudInit","state":"ACTIVE","attrs":{"exit_status":[],"script":"# Wait until cloud-init finished\nwhile [ ! -f \/var\/lib\/cloud\/instance\/boot-finished ]\ndo\n  sleep 1\ndone\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"centos"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Artifactory"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Birth_CIFS","state":"ACTIVE","attrs":{"exit_status":[],"script":"#mount smb share\nsudo mkdir \/mnt\/birth\necho '\/\/192.168.178.98\/iso \/mnt\/birth\tcifs\tusername=tfindelk,password=Timspw1c!' | sudo tee -a \/etc\/fstab\nsudo mount -a\n\n# Alternative insert CD\n\n\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"centos"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Artifactory"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"PrepareLocalRepos_Artifactory","state":"ACTIVE","attrs":{"exit_status":[],"script":"# Get rid off old repos \nsudo mkdir \/etc\/yum.repos.d\/old\nsudo mv \/etc\/yum.repos.d\/*.repo \/etc\/yum.repos.d\/old\n\n# Create repos from birth directory\n\n# Centos 7 Base repos (base,updates,extra,centosplus)\necho '\n# CentOS-Base.repo\n#\n# The mirror system uses the connecting IP address of the client and the\n# update status of each mirror to pick mirrors that are updated to and\n# geographically close to the client.  You should use this for CentOS updates\n# unless you are manually picking other mirrors.\n#\n# If the mirrorlist= does not work for you, as a fall back you can try the \n# remarked out baseurl= line instead.\n#\n#\n\n[base]\nname=CentOS-$releasever - Base\nbaseurl=file:\/\/@@{birth_project}@@\/repos\/base\ngpgcheck=1\ngpgkey=file:\/\/\/etc\/pki\/rpm-gpg\/RPM-GPG-KEY-CentOS-7\n\n#released updates \n[updates]\nname=CentOS-$releasever - Updates\nbaseurl=file:\/\/@@{birth_project}@@\/repos\/updates\ngpgcheck=1\ngpgkey=file:\/\/\/etc\/pki\/rpm-gpg\/RPM-GPG-KEY-CentOS-7\n\n#additional packages that may be useful\n[extras]\nname=CentOS-$releasever - Extras\nbaseurl=file:\/\/@@{birth_project}@@\/repos\/extras\ngpgcheck=1\ngpgkey=file:\/\/\/etc\/pki\/rpm-gpg\/RPM-GPG-KEY-CentOS-7\n\n#additional packages that extend functionality of existing packages\n[centosplus]\nname=CentOS-$releasever - Plus\nbaseurl=file:\/\/@@{birth_project}@@\/repos\/centosplus\ngpgcheck=1\nenabled=1\ngpgkey=file:\/\/\/etc\/pki\/rpm-gpg\/RPM-GPG-KEY-CentOS-7\n\n[epel]\nname=Extra Packages for Enterprise Linux 7 - $basearch\nbaseurl=file:\/\/@@{birth_project}@@\/repos\/epel\nfailovermethod=priority\nenabled=1\ngpgcheck=0\ngpgkey=file:\/\/\/etc\/pki\/rpm-gpg\/RPM-GPG-KEY-EPEL-7' | sudo tee -a \/etc\/yum.repos.d\/CentOS-Base.repo\n\n# Docker CE stable repos\necho '\n[docker-ce-stable]\nname=Docker CE Stable\nbaseurl=file:\/\/@@{birth_project}@@\/repos\/docker-ce-stable\/Packages\ngpgcheck=0\nenabled=1' | sudo tee -a \/etc\/yum.repos.d\/docker-ce-stable.repo\n\n# make sure cache is updated\nsudo yum makecache","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"centos"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Artifactory"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Install Docker","state":"ACTIVE","attrs":{"exit_status":[],"script":"# Install docker\nsudo yum install -y docker-ce\n\n# Start docker\nsudo systemctl start docker\n\n# Make sure docker service starts with system\nsudo systemctl enable docker\n\n# Enable user centos to use docker without sudo\nsudo usermod -aG docker centos","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"centos"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Artifactory"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Install Docker Compose","state":"ACTIVE","attrs":{"exit_status":[],"script":"### Install docker compose\nsudo cp @@{birth_project}@@\/downloads\/docker-compose \/usr\/local\/bin\/ \nsudo chmod +x \/usr\/local\/bin\/docker-compose","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"centos"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Artifactory"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Install Artifactory","state":"ACTIVE","attrs":{"script":"### Load docker image of artifactory\nsudo docker load -i @@{birth_project}@@\/downloads\/artifactory_image.docker","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Artifactory"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Start Artifactory","state":"ACTIVE","attrs":{"script":"### Run container artifactory on port 8081\ndocker run --name artifactory -d -p 8081:8081 docker.bintray.io\/jfrog\/artifactory-oss:6.5.0","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"97c81fe3_runbook_cloned_1_cloned_1","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"8f71dd71_dag_cloned_1_cloned_1"},"message_list":[],"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"InstallArtifactoryVM"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"4c070a87_dag_cloned_1_cloned_1","state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"c775740d_runbook_cloned_1_cloned_1","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"4c070a87_dag_cloned_1_cloned_1"},"message_list":[],"variable_list":[]}},"variable_list":[]},{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"DockerRegistry"}],"name":"InstallDockerRegistry","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"InstallDockerRegistry"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[{"kind":"app_task","name":"Wait_CloudInit"},{"kind":"app_task","name":"Birth_CIFS"},{"kind":"app_task","name":"PrepareLocalRepos_DockerRegistry"},{"kind":"app_task","name":"Install Docker"},{"kind":"app_task","name":"Install Docker Compose"},{"kind":"app_task","name":"Install DockerRegistry"},{"kind":"app_task","name":"Setup Init"},{"kind":"app_task","name":"Get Certificates"}],"name":"8f71dd71_dag_cloned_1_cloned_1_cloned_1","state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Wait_CloudInit"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Birth_CIFS"}},{"from_task_reference":{"kind":"app_task","name":"Birth_CIFS"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"PrepareLocalRepos_DockerRegistry"}},{"from_task_reference":{"kind":"app_task","name":"PrepareLocalRepos_DockerRegistry"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Install Docker"}},{"from_task_reference":{"kind":"app_task","name":"Install Docker"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Install Docker Compose"}},{"from_task_reference":{"kind":"app_task","name":"Install Docker Compose"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Install DockerRegistry"}},{"from_task_reference":{"kind":"app_task","name":"Install DockerRegistry"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Setup Init"}},{"from_task_reference":{"kind":"app_task","name":"Setup Init"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Get Certificates"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"DockerRegistry"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Wait_CloudInit","state":"ACTIVE","attrs":{"exit_status":[],"script":"# Wait until cloud-init finished\nwhile [ ! -f \/var\/lib\/cloud\/instance\/boot-finished ]\ndo\n  sleep 1\ndone\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"centos"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"DockerRegistry"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Birth_CIFS","state":"ACTIVE","attrs":{"exit_status":[],"script":"#mount smb share\nsudo mkdir \/mnt\/birth\necho '\/\/192.168.178.98\/iso \/mnt\/birth\tcifs\tusername=tfindelk,password=Timspw1c!' | sudo tee -a \/etc\/fstab\nsudo mount -a\n\n# Alternative insert CD\n\n\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"centos"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"DockerRegistry"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"PrepareLocalRepos_DockerRegistry","state":"ACTIVE","attrs":{"exit_status":[],"script":"# Get rid off old repos \nsudo mkdir \/etc\/yum.repos.d\/old\nsudo mv \/etc\/yum.repos.d\/*.repo \/etc\/yum.repos.d\/old\n\n# Create repos from birth directory\n\n# Centos 7 Base repos (base,updates,extra,centosplus)\necho '\n# CentOS-Base.repo\n#\n# The mirror system uses the connecting IP address of the client and the\n# update status of each mirror to pick mirrors that are updated to and\n# geographically close to the client.  You should use this for CentOS updates\n# unless you are manually picking other mirrors.\n#\n# If the mirrorlist= does not work for you, as a fall back you can try the \n# remarked out baseurl= line instead.\n#\n#\n\n[base]\nname=CentOS-$releasever - Base\nbaseurl=file:\/\/@@{birth_project}@@\/repos\/base\ngpgcheck=1\ngpgkey=file:\/\/\/etc\/pki\/rpm-gpg\/RPM-GPG-KEY-CentOS-7\n\n#released updates \n[updates]\nname=CentOS-$releasever - Updates\nbaseurl=file:\/\/@@{birth_project}@@\/repos\/updates\ngpgcheck=1\ngpgkey=file:\/\/\/etc\/pki\/rpm-gpg\/RPM-GPG-KEY-CentOS-7\n\n#additional packages that may be useful\n[extras]\nname=CentOS-$releasever - Extras\nbaseurl=file:\/\/@@{birth_project}@@\/repos\/extras\ngpgcheck=1\ngpgkey=file:\/\/\/etc\/pki\/rpm-gpg\/RPM-GPG-KEY-CentOS-7\n\n#additional packages that extend functionality of existing packages\n[centosplus]\nname=CentOS-$releasever - Plus\nbaseurl=file:\/\/@@{birth_project}@@\/repos\/centosplus\ngpgcheck=1\nenabled=1\ngpgkey=file:\/\/\/etc\/pki\/rpm-gpg\/RPM-GPG-KEY-CentOS-7\n\n[epel]\nname=Extra Packages for Enterprise Linux 7 - $basearch\nbaseurl=file:\/\/@@{birth_project}@@\/repos\/epel\nfailovermethod=priority\nenabled=1\ngpgcheck=0\ngpgkey=file:\/\/\/etc\/pki\/rpm-gpg\/RPM-GPG-KEY-EPEL-7' | sudo tee -a \/etc\/yum.repos.d\/CentOS-Base.repo\n\n# Docker CE stable repos\necho '\n[docker-ce-stable]\nname=Docker CE Stable\nbaseurl=file:\/\/@@{birth_project}@@\/repos\/docker-ce-stable\/Packages\ngpgcheck=0\nenabled=1' | sudo tee -a \/etc\/yum.repos.d\/docker-ce-stable.repo\n\n# make sure cache is updated\nsudo yum makecache","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"centos"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"DockerRegistry"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Install Docker","state":"ACTIVE","attrs":{"exit_status":[],"script":"# Install docker\nsudo yum install -y docker-ce\n\n# Start docker\nsudo systemctl start docker\n\n# Make sure docker service starts with system\nsudo systemctl enable docker\n\n# Enable user centos to use docker without sudo\nsudo usermod -aG docker centos","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"centos"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"DockerRegistry"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Install Docker Compose","state":"ACTIVE","attrs":{"exit_status":[],"script":"### Install docker compose\nsudo cp @@{birth_project}@@\/downloads\/docker-compose \/usr\/local\/bin\/ \nsudo chmod +x \/usr\/local\/bin\/docker-compose","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"centos"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"DockerRegistry"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Install DockerRegistry","state":"ACTIVE","attrs":{"script":"### htpasswd is needed\nsudo yum install -y httpd-tools\n\necho \"Creating docker-registry directory...\"\nsudo mkdir -p \/docker-registry\/data \nsudo mkdir -p \/docker-registry\/nginx\n\necho \"Creating docker-registry.yml file...\"\necho 'nginx:\n  image: \"nginx:1.9\"\n  ports:\n    - 443:443\n  links:\n    - registry:registry\n  volumes:\n    - .\/nginx\/:\/etc\/nginx\/conf.d\nregistry:\n  image: registry:2\n  ports:\n    - 127.0.0.1:5000:5000\n  environment:\n    REGISTRY_STORAGE_FILESYSTEM_ROOTDIRECTORY: \/data\n  volumes:\n    - .\/data:\/data' | sudo tee \/docker-registry\/docker-compose.yml\n\necho 'upstream docker-registry {\n  server registry:5000;\n}\n\nserver {\n  listen 443;\n  server_name @@{name}@@.@@{domain_name}@@;\n\n  # SSL\n  ssl on;\n  ssl_certificate \/etc\/nginx\/conf.d\/domain.crt;\n  ssl_certificate_key \/etc\/nginx\/conf.d\/domain.key;\n\n  # disable any limits to avoid HTTP 413 for large image uploads\n  client_max_body_size 0;\n\n  # required to avoid HTTP 411: see Issue #1486 (https:\/\/github.com\/docker\/docker\/issues\/1486)\n  chunked_transfer_encoding on;\n\n  location \/v2\/ {\n    # Do not allow connections from docker 1.5 and earlier\n    if ($http_user_agent ~ \"^(docker\\\/1\\.(3|4|5(?!\\.[0-9]-dev))|Go ).*$\" ) {\n      return 404;\n    }\n\n    # To add basic authentication to v2 use auth_basic setting plus add_header\n    auth_basic \"registry.localhost\";\n    auth_basic_user_file \/etc\/nginx\/conf.d\/registry.password;\n    add_header \"Docker-Distribution-Api-Version\" \"registry\/2.0\" always;\n\n    proxy_pass                          http:\/\/docker-registry;\n    proxy_set_header  Host              $http_host;   \n    proxy_set_header  X-Real-IP         $remote_addr; \n    proxy_set_header  X-Forwarded-For   $proxy_add_x_forwarded_for;\n    proxy_set_header  X-Forwarded-Proto $scheme;\n    proxy_read_timeout                  900;\n  }\n}' | sudo tee \/docker-registry\/nginx\/registry.conf\n\necho @@{centos.secret}@@ | sudo htpasswd -ci \/docker-registry\/nginx\/registry.password @@{centos.username}@@ \n\nsudo openssl genrsa -out \/docker-registry\/nginx\/devdockerCA.key 2048\n\nsudo openssl req -x509 -new -nodes -key \/docker-registry\/nginx\/devdockerCA.key -days 10000 -out \/docker-registry\/nginx\/devdockerCA.crt -subj \"\/C=US\/ST=California\/L=San Jose\/O=nutnaix\/OU=DevOps\/CN=@@{name}@@.@@{domain_name}@@\/emailAddress=''\"\n\nsudo openssl genrsa -out \/docker-registry\/nginx\/domain.key 2048\n\nsudo openssl req -new -key \/docker-registry\/nginx\/domain.key -out \/docker-registry\/nginx\/dev-docker-registry.com.csr -subj \"\/C=US\/ST=California\/L=San Jose\/O=nutnaix\/OU=DevOps\/CN=@@{name}@@.@@{domain_name}@@\/emailAddress=''\"\n\nsudo openssl x509 -req -in \/docker-registry\/nginx\/dev-docker-registry.com.csr -CA \/docker-registry\/nginx\/devdockerCA.crt -CAkey \/docker-registry\/nginx\/devdockerCA.key -CAcreateserial -out \/docker-registry\/nginx\/domain.crt -days 10000\n\nsudo mkdir \/usr\/local\/share\/ca-certificates\/docker-dev-cert\nsudo cp \/docker-registry\/nginx\/devdockerCA.crt \/usr\/local\/share\/ca-certificates\/docker-dev-cert\nsudo update-ca-certificates\n\nsudo service docker restart\n","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"DockerRegistry"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Setup Init","state":"ACTIVE","attrs":{"exit_status":[],"script":"echo '[Unit]\nDescription=Docker Application Container Engine\nDocumentation=https:\/\/docs.docker.com\nAfter=network-online.target \n\n[Service]\nType=notify\n# the default is not to use systemd for cgroups because the delegate issues still\n# exists and systemd currently does not support the cgroup feature set required\n# for containers run by docker\nExecStart=\/usr\/local\/bin\/docker-compose -f \/docker-registry\/docker-compose.yml up -d\nExecReload=\/bin\/kill -s HUP $MAINPID\nLimitNOFILE=1048576\n# Having non-zero Limit*s causes performance problems due to accounting overhead\n# in the kernel. We recommend using cgroups to do container-local accounting.\nLimitNPROC=infinity\nLimitCORE=infinity\n# Uncomment TasksMax if your systemd version supports it.\n# Only systemd 226 and above support this version.\nTasksMax=infinity\nTimeoutStartSec=0\n# set delegate yes so that systemd does not reset the cgroups of docker containers\nDelegate=yes\n# kill only the docker process, not all processes in the cgroup\nKillMode=process\n# restart the docker process if it exits prematurely\nRestart=on-failure\nStartLimitBurst=3\nStartLimitInterval=60s\n\n[Install]\nWantedBy=multi-user.target' | sudo tee \/etc\/systemd\/system\/docker-registry.service \n\nsudo service docker-registry start\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"centos"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"DockerRegistry"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Get Certificates","state":"ACTIVE","attrs":{"exit_status":[],"script":"cp @@{birth_project}@@\/keys\/*.* ~\/.ssh\/\nsudo cp \/docker-registry\/nginx\/devdockerCA.crt ~\/\nsudo chown ${USER}:${USER} ~\/devdockerCA.crt\nchmod 600 ~\/devdockerCA.crt","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"centos"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"97c81fe3_runbook_cloned_1_cloned_1_cloned_1","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"8f71dd71_dag_cloned_1_cloned_1_cloned_1"},"message_list":[],"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"InstallDockerRegistry"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"4c070a87_dag_cloned_1_cloned_1_cloned_1","state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"c775740d_runbook_cloned_1_cloned_1_cloned_1","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"4c070a87_dag_cloned_1_cloned_1_cloned_1"},"message_list":[],"variable_list":[]}},"variable_list":[]},{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"Jenkins Master"}],"name":"InstallJenkinsMasterVM","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"InstallJenkinsMasterVM"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[{"kind":"app_task","name":"Wait_CloudInit"},{"kind":"app_task","name":"Birth_CIFS"},{"kind":"app_task","name":"PrepareLocalRepos_JenkinsMaster"},{"kind":"app_task","name":"Install JenkinsMaster"},{"kind":"app_task","name":"Configure Base User"},{"kind":"app_task","name":"Get App Deploy Blueprint UUID"}],"name":"8f71dd71_dag_cloned_1_cloned_1","state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Wait_CloudInit"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Birth_CIFS"}},{"from_task_reference":{"kind":"app_task","name":"Birth_CIFS"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"PrepareLocalRepos_JenkinsMaster"}},{"from_task_reference":{"kind":"app_task","name":"PrepareLocalRepos_JenkinsMaster"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Install JenkinsMaster"}},{"from_task_reference":{"kind":"app_task","name":"Install JenkinsMaster"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Configure Base User"}},{"from_task_reference":{"kind":"app_task","name":"Configure Base User"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Get App Deploy Blueprint UUID"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Wait_CloudInit","state":"ACTIVE","attrs":{"exit_status":[],"script":"# Wait until cloud-init finished\nwhile [ ! -f \/var\/lib\/cloud\/instance\/boot-finished ]\ndo\n  sleep 1\ndone\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"centos"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Birth_CIFS","state":"ACTIVE","attrs":{"exit_status":[],"script":"#mount smb share\nsudo mkdir \/mnt\/birth\necho '\/\/192.168.178.98\/iso \/mnt\/birth\tcifs\tusername=tfindelk,password=Timspw1c!' | sudo tee -a \/etc\/fstab\nsudo mount -a\n\n# Alternative insert CD\n\n\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"centos"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"PrepareLocalRepos_JenkinsMaster","state":"ACTIVE","attrs":{"exit_status":[],"script":"# Get rid off old repos \nsudo mkdir \/etc\/yum.repos.d\/old\nsudo mv \/etc\/yum.repos.d\/*.repo \/etc\/yum.repos.d\/old\n\n# Create repos from birth directory\n\n# Centos 7 Base repos (base,updates,extra,centosplus)\necho '\n# CentOS-Base.repo\n#\n# The mirror system uses the connecting IP address of the client and the\n# update status of each mirror to pick mirrors that are updated to and\n# geographically close to the client.  You should use this for CentOS updates\n# unless you are manually picking other mirrors.\n#\n# If the mirrorlist= does not work for you, as a fall back you can try the \n# remarked out baseurl= line instead.\n#\n#\n\n[base]\nname=CentOS-$releasever - Base\nbaseurl=file:\/\/@@{birth_project}@@\/repos\/base\ngpgcheck=1\ngpgkey=file:\/\/\/etc\/pki\/rpm-gpg\/RPM-GPG-KEY-CentOS-7\n\n#released updates \n[updates]\nname=CentOS-$releasever - Updates\nbaseurl=file:\/\/@@{birth_project}@@\/repos\/updates\ngpgcheck=1\ngpgkey=file:\/\/\/etc\/pki\/rpm-gpg\/RPM-GPG-KEY-CentOS-7\n\n#additional packages that may be useful\n[extras]\nname=CentOS-$releasever - Extras\nbaseurl=file:\/\/@@{birth_project}@@\/repos\/extras\ngpgcheck=1\ngpgkey=file:\/\/\/etc\/pki\/rpm-gpg\/RPM-GPG-KEY-CentOS-7\n\n#additional packages that extend functionality of existing packages\n[centosplus]\nname=CentOS-$releasever - Plus\nbaseurl=file:\/\/@@{birth_project}@@\/repos\/centosplus\ngpgcheck=1\nenabled=1\ngpgkey=file:\/\/\/etc\/pki\/rpm-gpg\/RPM-GPG-KEY-CentOS-7\n\n[epel]\nname=Extra Packages for Enterprise Linux 7 - $basearch\nbaseurl=file:\/\/@@{birth_project}@@\/repos\/epel\nfailovermethod=priority\nenabled=1\ngpgcheck=0\ngpgkey=file:\/\/\/etc\/pki\/rpm-gpg\/RPM-GPG-KEY-EPEL-7' | sudo tee -a \/etc\/yum.repos.d\/CentOS-Base.repo\n\n# Docker CE stable repos\necho '\n[docker-ce-stable]\nname=Docker CE Stable\nbaseurl=file:\/\/@@{birth_project}@@\/repos\/docker-ce-stable\/Packages\ngpgcheck=0\nenabled=1' | sudo tee -a \/etc\/yum.repos.d\/docker-ce-stable.repo\n\n# Jenkins stable repos\necho '\n[Jenkins-stable]\nname=Jenkins-stable\nbaseurl=file:\/\/@@{birth_project}@@\/repos\/jenkins\ngpgcheck=0\nenabled=1' | sudo tee -a \/etc\/yum.repos.d\/jenkins.repo\n\n\n\n# make sure cache is updated\nsudo yum makecache","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"centos"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Install JenkinsMaster","state":"ACTIVE","attrs":{"exit_status":[],"script":"### Java Runtime needed by Jenkins\nsudo yum install -y java-1.8.0-openjdk.x86_64\n\n### Setup Java environment\nsudo cp \/etc\/profile \/etc\/profile_backup\necho 'export JAVA_HOME=\/usr\/lib\/jvm\/jre-1.8.0-openjdk' | sudo tee -a \/etc\/profile\necho 'export JRE_HOME=\/usr\/lib\/jvm\/jre' | sudo tee -a \/etc\/profile\nsource \/etc\/profile\n\n### Install Jenkins from repos\nsudo yum install -y jenkins\n\n# Start Jenkins\nsudo systemctl start jenkins.service\n\n# Make sure JEnkins service starts with system\nsudo systemctl enable jenkins.service\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"centos"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Configure Base User","state":"ACTIVE","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"5ea2d4b5_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Get App Deploy Blueprint UUID","state":"ACTIVE","attrs":{"script":"user= \"@@{PrismCentral.username}@@\"\npassword = \"@@{PrismCentral.secret}@@\"\n\ndef process_request(url, method, user, password, headers, payload=None):\n    r = urlreq(url, verb=method, auth=\"BASIC\", user=user, passwd=password, params=payload, verify=False, headers=headers)\n    return r\n\nurl = \"https:\/\/@@{PrismCentralIP}@@:9440\/api\/nutanix\/v3\/blueprints\/list\"\nheaders = {'Accept': 'application\/json', 'Content-Type': 'application\/json'}\nurl_method = \"POST\"\npayload = {\"filter\": \"name==@@{app_deploy_blueprint}@@\"}\nr = process_request(url, url_method, user, password, headers, json.dumps(payload))\nprint \"Response Status: \" + str(r.status_code)\nprint \"Response: \", r.json()\n\nprint \"app_deploy_blueprint_uuid=\", r.json()['entities'][0]['status']['uuid']","type":"","command_line_args":"","exit_status":[],"script_type":"static"},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"97c81fe3_runbook_cloned_1_cloned_2","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"8f71dd71_dag_cloned_1_cloned_1"},"message_list":[],"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"InstallJenkinsMasterVM"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"4c070a87_dag_cloned_1_cloned_1","state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"c775740d_runbook_cloned_1_cloned_2","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"4c070a87_dag_cloned_1_cloned_1"},"message_list":[],"variable_list":[]}},"variable_list":[]},{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"Jenkins Slave"}],"name":"InstallJenkinsSlave","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"InstallJenkinsSlave"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[{"kind":"app_task","name":"Wait_CloudInit"},{"kind":"app_task","name":"Birth_CIFS"},{"kind":"app_task","name":"PrepareLocalRepos_JenkinsSlave"},{"kind":"app_task","name":"Install Docker"},{"kind":"app_task","name":"Install Docker Compose"},{"kind":"app_task","name":"Install NodeJS"}],"name":"8f71dd71_dag_cloned_1_cloned_1_cloned_1","state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Wait_CloudInit"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Birth_CIFS"}},{"from_task_reference":{"kind":"app_task","name":"Birth_CIFS"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"PrepareLocalRepos_JenkinsSlave"}},{"from_task_reference":{"kind":"app_task","name":"PrepareLocalRepos_JenkinsSlave"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Install Docker"}},{"from_task_reference":{"kind":"app_task","name":"Install Docker"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Install Docker Compose"}},{"from_task_reference":{"kind":"app_task","name":"Install Docker Compose"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Install NodeJS"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Slave"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Wait_CloudInit","state":"ACTIVE","attrs":{"exit_status":[],"script":"# Wait until cloud-init finished\nwhile [ ! -f \/var\/lib\/cloud\/instance\/boot-finished ]\ndo\n  sleep 1\ndone\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"centos"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Slave"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Birth_CIFS","state":"ACTIVE","attrs":{"exit_status":[],"script":"#mount smb share\nsudo mkdir \/mnt\/birth\necho '\/\/192.168.178.98\/iso \/mnt\/birth\tcifs\tusername=tfindelk,password=Timspw1c!' | sudo tee -a \/etc\/fstab\nsudo mount -a\n\n# Alternative insert CD\n\n\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"centos"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Slave"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"PrepareLocalRepos_JenkinsSlave","state":"ACTIVE","attrs":{"exit_status":[],"script":"# Get rid off old repos \nsudo mkdir \/etc\/yum.repos.d\/old\nsudo mv \/etc\/yum.repos.d\/*.repo \/etc\/yum.repos.d\/old\n\n# Create repos from birth directory\n\n# Centos 7 Base repos (base,updates,extra,centosplus)\necho '\n# CentOS-Base.repo\n#\n# The mirror system uses the connecting IP address of the client and the\n# update status of each mirror to pick mirrors that are updated to and\n# geographically close to the client.  You should use this for CentOS updates\n# unless you are manually picking other mirrors.\n#\n# If the mirrorlist= does not work for you, as a fall back you can try the \n# remarked out baseurl= line instead.\n#\n#\n\n[base]\nname=CentOS-$releasever - Base\nbaseurl=file:\/\/@@{birth_project}@@\/repos\/base\ngpgcheck=1\ngpgkey=file:\/\/\/etc\/pki\/rpm-gpg\/RPM-GPG-KEY-CentOS-7\n\n#released updates \n[updates]\nname=CentOS-$releasever - Updates\nbaseurl=file:\/\/@@{birth_project}@@\/repos\/updates\ngpgcheck=1\ngpgkey=file:\/\/\/etc\/pki\/rpm-gpg\/RPM-GPG-KEY-CentOS-7\n\n#additional packages that may be useful\n[extras]\nname=CentOS-$releasever - Extras\nbaseurl=file:\/\/@@{birth_project}@@\/repos\/extras\ngpgcheck=1\ngpgkey=file:\/\/\/etc\/pki\/rpm-gpg\/RPM-GPG-KEY-CentOS-7\n\n#additional packages that extend functionality of existing packages\n[centosplus]\nname=CentOS-$releasever - Plus\nbaseurl=file:\/\/@@{birth_project}@@\/repos\/centosplus\ngpgcheck=1\nenabled=1\ngpgkey=file:\/\/\/etc\/pki\/rpm-gpg\/RPM-GPG-KEY-CentOS-7\n\n[epel]\nname=Extra Packages for Enterprise Linux 7 - $basearch\nbaseurl=file:\/\/@@{birth_project}@@\/repos\/epel\nfailovermethod=priority\nenabled=1\ngpgcheck=0\ngpgkey=file:\/\/\/etc\/pki\/rpm-gpg\/RPM-GPG-KEY-EPEL-7' | sudo tee -a \/etc\/yum.repos.d\/CentOS-Base.repo\n\n# Docker CE stable repos\necho '\n[docker-ce-stable]\nname=Docker CE Stable\nbaseurl=file:\/\/@@{birth_project}@@\/repos\/docker-ce-stable\/Packages\ngpgcheck=0\nenabled=1' | sudo tee -a \/etc\/yum.repos.d\/docker-ce-stable.repo\n\n# Jenkins stable repos\necho '\n[Jenkins-stable]\nname=Jenkins-stable\nbaseurl=file:\/\/@@{birth_project}@@\/repos\/jenkins\ngpgcheck=0\nenabled=1' | sudo tee -a \/etc\/yum.repos.d\/jenkins.repo\n\n\n\n# make sure cache is updated\nsudo yum makecache","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"centos"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Slave"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Install Docker","state":"ACTIVE","attrs":{"exit_status":[],"script":"# Install docker\nsudo yum install -y docker-ce\n\n# Start docker\nsudo systemctl start docker\n\n# Make sure docker service starts with system\nsudo systemctl enable docker\n\n# Enable user centos to use docker without sudo\nsudo usermod -aG docker centos","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"centos"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Slave"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Install Docker Compose","state":"ACTIVE","attrs":{"script":"### Install docker compose\nsudo cp @@{birth_project}@@\/downloads\/docker-compose \/usr\/local\/bin\/ \nsudo chmod +x \/usr\/local\/bin\/docker-compose","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Slave"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Install NodeJS","state":"ACTIVE","attrs":{"exit_status":[],"script":"# Install nodejs\nsudo yum install -y nodejs","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"centos"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"97c81fe3_runbook_cloned_1_cloned_2_cloned_1","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"8f71dd71_dag_cloned_1_cloned_1_cloned_1"},"message_list":[],"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"InstallJenkinsSlave"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"4c070a87_dag_cloned_1_cloned_1_cloned_1","state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"c775740d_runbook_cloned_1_cloned_2_cloned_1","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"4c070a87_dag_cloned_1_cloned_1_cloned_1"},"message_list":[],"variable_list":[]}},"variable_list":[]}],"app_profile_list":[{"deployment_create_list":[{"type":"GREENFIELD","action_list":[],"depends_on_list":[],"name":"073fb9fd_deployment","published_service_local_reference_list":[],"max_replicas":"1","package_local_reference_list":[{"kind":"app_package","name":"InstallWokstationVM"}],"substrate_local_reference":{"kind":"app_substrate","name":"WorkstationVM"},"min_replicas":"1","variable_list":[],"description":""},{"type":"GREENFIELD","action_list":[],"depends_on_list":[],"name":"073fb9fd_deployment_cloned_1","published_service_local_reference_list":[],"max_replicas":"1","package_local_reference_list":[{"kind":"app_package","name":"InstallGitoLiteVM"}],"substrate_local_reference":{"kind":"app_substrate","name":"GitoLiteVM"},"min_replicas":"1","variable_list":[],"description":""},{"type":"GREENFIELD","action_list":[],"depends_on_list":[],"name":"073fb9fd_deployment_cloned_1_cloned_1","published_service_local_reference_list":[],"max_replicas":"1","package_local_reference_list":[{"kind":"app_package","name":"InstallArtifactoryVM"}],"substrate_local_reference":{"kind":"app_substrate","name":"ArtifactoryVM"},"min_replicas":"1","variable_list":[],"description":""},{"type":"GREENFIELD","action_list":[],"depends_on_list":[],"name":"073fb9fd_deployment_cloned_1_cloned_1_cloned_1","published_service_local_reference_list":[],"max_replicas":"1","package_local_reference_list":[{"kind":"app_package","name":"InstallDockerRegistry"}],"substrate_local_reference":{"kind":"app_substrate","name":"DockerRegistryVM"},"min_replicas":"1","variable_list":[],"description":""},{"type":"GREENFIELD","action_list":[],"depends_on_list":[],"name":"073fb9fd_deployment_cloned_1_cloned_2","published_service_local_reference_list":[],"max_replicas":"1","package_local_reference_list":[{"kind":"app_package","name":"InstallJenkinsMasterVM"}],"substrate_local_reference":{"kind":"app_substrate","name":"JenkinsMasterVM"},"min_replicas":"1","variable_list":[],"description":""},{"type":"GREENFIELD","action_list":[],"depends_on_list":[],"name":"073fb9fd_deployment_cloned_1_cloned_2_cloned_1","published_service_local_reference_list":[],"max_replicas":"5","package_local_reference_list":[{"kind":"app_package","name":"InstallJenkinsSlave"}],"substrate_local_reference":{"kind":"app_substrate","name":"JenkinsSlaveVM"},"min_replicas":"2","variable_list":[],"description":""}],"description":"","action_list":[],"name":"NFS bootstrap","variable_list":[{"val_type":"STRING","description":"","name":"birth_project","type":"LOCAL","value":"\/mnt\/birth\/devops\/CI-CD-example","label":"","attrs":{"type":""}},{"val_type":"STRING","description":"","name":"domain_name","type":"LOCAL","value":"ntnx.local","label":"","attrs":{"type":""}},{"val_type":"STRING","description":"","name":"PrismCentralIP","type":"LOCAL","value":"192.168.178.80","label":"","attrs":{"type":""}},{"val_type":"STRING","description":"","name":"app_deploy_blueprint","type":"LOCAL","value":"CI-CD-example-APP","label":"","attrs":{"type":""}}]}],"published_service_definition_list":[],"default_credential_local_reference":{"kind":"app_credential","name":"centos"},"type":"USER"},"name":"CI-CD-example-BASE"},"api_version":"3.0","metadata":{"last_update_time":"1545385562303168","kind":"blueprint","spec_version":93,"creation_time":"1539252758661734","name":"CI-CD-example-BASE"}}